define(function(require,exports,module){module.exports=function(e,t,i,o,r){var c=this;this.PAGE=e,this.tree=t,this.queryBtn=i,this.queryInput=o,this.fileType=r;var a=this;this.getTask=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],s=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=arguments[3],l=arguments[4],n=arguments[5],d=c;$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_folder_menu","v4.0",{fileType:c.fileType},function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(o&&(t=$.kingdom.filterFoldName(e.bcjson.items,o)),0===t.length)return void $(""+c.tree).html('<div class="no-data">没有查询数据</div>');var i=(new $.kingdom.generateTreeData).init("",t,"foldName","folderId");r&&($(""+c.tree).jstree("destroy"),$(""+c.tree).html(i),$(""+c.tree).jstree({core:{themes:{responsive:!1},check_callback:!0},plugins:["types","themes","html_data","state"]}),$(""+c.tree).jstree(!0),$(""+c.tree).on("ready.jstree",function(e,t){a?$(d.tree+" li[folderid="+a+"]>.jstree-anchor").click():$(d.tree+" .jstree-anchor:first").click();var i=t.instance,o=i.get_node(e.target.firstChild.firstChild.lastChild);i.open_node(o),n&&i.open_all(),App.treeEllipsis(""+d.tree),l&&l()})),s&&($(c.PAGE+" [type=jstree]").jstree("destroy"),$(c.PAGE+" [type=jstree]").html(i),$(c.PAGE+" [type=jstree]").jstree({types:{default:{icon:!1}},core:{themes:{responsive:!1},check_callback:!0},plugins:["types","themes","html_data","contextmenu","state"]}))}})},this.addTask=function(i){var o=c,e=$.trim(i.text),r={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"ADD",folderName:e,parentFolderId:parentFolderId,isParentFolder:"#"===i.parents[1]?"1":"0"};if(!e)return toastr.info("File Name is missing"),void o.getTask("",!0,!1,r.parentFolderId);$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",r,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items[0].folderId;$(c.tree+" li[id="+i.id+"]").attr("folderId",t),o.getTask("",!0,!0,t),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)}else o.getTask("",!0,!1,r.parentFolderId),toastr.error(e.bcjson.msg)})},this.editTask=function(t){var i=c,e=$.trim(t.text),o={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"UPD",folderName:e,folderId:t.li_attr.folderid};if(!e)return toastr.info("File Name is missing"),void i.getTask("",!0,!1,o.folderId);$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",o,function(e){"1"==e.bcjson.flag?($(c.tree+" li[id="+t.id+"]").attr("folderId",o.folderId),i.getTask("",!0,!0,o.folderId),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)):(i.getTask("",!0,!1,o.folderId),toastr.error(e.bcjson.msg))})},this.delTask=function(t){var i=c,o={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"DEL",folderId:t.folderId};$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",o,function(e){"1"==e.bcjson.flag?($(c.tree+" li[id="+t.parent+"]>a").click(),i.getTask("",!1,!0),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)):(i.getTask("",!0,!1,o.folderId),toastr.error(e.bcjson.msg))})},$("body").on("click",this.PAGE+" "+this.queryBtn,function(){var e=$.trim($(a.PAGE+" "+a.queryInput).val());a.getTask(e,!0,!1,"","",!0)}),$("body").on("keydown",this.PAGE+" "+this.queryInput,function(e){if("13"==e.keyCode){e.preventDefault();var t=$.trim($(this).val());a.getTask(t,!0,!1,"","",!0)}}),$("body").on("mouseenter",this.tree+" .jstree-anchor",function(){console.log((new Date).getTime());var e=$(this).closest("li").attr("aria-level");1!==$(this).find(".jstree-operate").length&&("1"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#464C51;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#464C51;"></i></a></div>'):"2"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#464C51;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#464C51;"></i></a><a name="del" title="DELETE"><i class="glyphicon glyphicon-trash" style="color:#464C51;"></i></a></div>'):"3"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#464C51;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#464C51;"></i></a><a name="del" title="DELETE"><i class="glyphicon glyphicon-trash" style="color:#464C51;"></i></a></div>'):$(this).append('<div class="jstree-operate"><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#464C51;"></i></a><a name="del" title="DELTTE"><i class="glyphicon glyphicon-trash" style="color:#464C51;"></i></a></div></div>'))}),$("body").on("mouseleave",this.tree+" .jstree-anchor",function(){$(".jstree-operate").remove()}),$("body").on("mouseenter",this.tree+" .jstree-operate",function(){$(this).css("z-index",1e4)}),$("body").on("click",this.PAGE+" .jstree-operate [name=add]",function(e){console.log('111');var t=$(this).closest(".jstree-anchor"),i=$.jstree.reference(t),o=i.get_node(t);parentFolderId=$(a.tree+" li[id="+o.id+"]").attr("folderid");var r=o.parents.length;if(3<r)toastr.info("不能创建子目录");else{o.types=["fa fa-folder icon-state-primary icon-lg","fa fa-folder icon-state-primary","fa fa-file icon-state-default","fa fa-file icon-state-primary","fa fa-file icon-state-primary"][r];var s=i.create_node(o,{},"first");i.edit(s,$.trim(s.val),"64",a.addTask)}}),$("body").on("click",this.PAGE+" .jstree-operate [name=edit]",function(e){var t=$(this).closest(".jstree-anchor"),i=$.jstree.reference(t),o=i.get_node(t);o.li_attr.folderid=$(a.tree+" li[id="+o.id+"]").attr("folderid"),i.edit(t,$.trim(o.text),"64",a.editTask)}),$("body").on("click",this.PAGE+" .jstree-operate [name=del]",function(e){var i=$(this).closest(".jstree-anchor"),o=$.jstree.reference(i),r=o.get_node(i);r.li_attr.folderid=$(a.tree+" li[id="+r.id+"]").attr("folderid"),bootbox.confirm("Please confirm to delete  <span style='color:red'>"+r.text+"</span>",function(e){if(e){o.delete_node(i);var t=r.li_attr.folderid;a.delTask({folderId:t,parent:r.parent})}})})}});