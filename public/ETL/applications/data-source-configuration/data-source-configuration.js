var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};define(function(require,exports,module){var r=require("./data-source-configurationShow"),t={load:function(){r.load(),r.connect_id="",r.db_password="";var t=document.getElementById("J_drag_bar7"),e=document.getElementById("J_drag_bar7");startDrag(t,e,".left-side-source",".right-content-source",function(){LFWIDTH=$(".left-side").width()})}};$(function(){$("body").on("keydown","#data-source-configuration #J_dsc_list_search",function(t){13==t.keyCode&&$("#data-source-configuration #dsc-search").click()}),$("body").on("click","#data-source-configuration #dsc-search",function(){var t=$(this).siblings("input").val();r.get_source_connect_List(t)}),$("body").on("click","#data-source-configuration #data-source-configuration-reset",function(){$("#data-source-configuration-form #schemName").val(""),$("#data-source-configuration-form #tableName").val(""),$("#data-source-configuration-query").click()}),$("body").on("click","#data-source-configuration-query",function(){var t=App.getFormParams("data-source-configuration-form");t.connectionId=r.connect_id,-1<r.connection_type.indexOf("文件")?(r.hideShowBlock("#J_dsc_file_list_detail"),r.getExcelFileDetail(t)):(r.hideShowBlock("#J_dsc_list_detail"),r.qry_connect_data(t))}),$("body").on("click","#data-source-configuration .data-source-configuration-list li",function(){var t={pageNumber:"1"};$(this).addClass("click-add-background"),$(this).siblings().removeClass("click-add-background");var e=$(this).find("span a").data("params");r.connect_id=e.connect_id,r.connection_type=e.connection_type,$("#J_dsc_list_detail_title_type span").html(e.connection_name+"<span> / "+e.connection_type+"</span>"),r.getUser({connection_id:e.connect_id}),-1<e.connection_type.indexOf("文件")?(r.hideShowBlock("#J_dsc_file_list_detail"),r.getExcelFileDetail({connectionId:e.connect_id})):(r.hideShowBlock("#J_dsc_list_detail"),r.qry_connect_data(t))}),$("body").on("click","#data-source-configuration .winbd li",function(){"Excel"===$(this).find("a .txt").text()||"CSV"===$(this).find("a .txt").text()?(r.getConnectType($(this).find("a .txt").text()),r.clearFileBlock(),r.hideShowBlock("#J_dsc_fileType_add"),r.fileEdit=!1):(r.getConnectType($(this).find("a .txt").text()),r.hideShowBlock("#J_dsc_commonType_add")),$("#J_dsc_list_detail_title_type span").html("新增连接<span> / "+$(this).find("a .txt").text()+"</span>"),$("#data-connect-add-type button").click(),r.getDataSourceList(),$("#data-source-configuration [name=submitNum]").val("4096")}),$("body").on("blur","#data-connect-add-form input[name='principal']",function(){var t=$("#J_dsc_commonType_add input[name=jdbc_string]").val().split(";principal="),e="";e=2==t.length?t[0]:$("#J_dsc_commonType_add input[name=jdbc_string]").val(),""!=$(this).val()?$("#J_dsc_commonType_add input[name=jdbc_string]").val(e+";principal="+$(this).val()):$("#J_dsc_commonType_add input[name=jdbc_string]").val(e)}),$("body").on("click","#data-source-configuration #test-data-connect",function(){if(!$("#data-connect-add-form").validate().form())return!1;var t={};t.connection_name=$("#connection_name").val(),t.connection_desc=$("#data-connect-add-form input[name='connection_desc']").val(),t.connection_type=$("#connection_type").val(),t.server=$("#data-connect-add-form input[name='server']").val(),t.db_port=$("#data-connect-add-form input[name='db_port']").val(),t.db_database=$("#data-connect-add-form input[name='db_database']").val(),t.db_user=$("#data-connect-add-form input[name='db_user']").val();var e=$("#data-connect-add-form input[name='db_password']").val();t.db_password=$.des.getDes(e),t.jdbc_string=$("#data-connect-add-form input[name='jdbc_string']").val(),t.max_connect_count=$("#data-connect-add-form input[name='max_connect_count']").val(),t.driverInfo=$("#connection_type option:selected").attr("className"),App.blockUI({boxed:!0,message:"测试中..."}),r.testDataConnectList(t)}),$("body").on("click","#data-source-configuration #data-connect-add-submit",function(){if(!$("#data-connect-add-form").validate().form())return!1;var t={};t.connection_name=$("#connection_name").val(),t.connection_desc=$("#data-connect-add-form input[name='connection_desc']").val(),t.connection_type=$("#connection_type").val(),t.server=$("#data-connect-add-form input[name='server']").val(),t.db_port=$("#data-connect-add-form input[name='db_port']").val(),t.db_database=$("#data-connect-add-form input[name='db_database']").val(),t.db_user=$("#data-connect-add-form input[name='db_user']").val(),t.db_password=$.des.getDes($("#data-connect-add-form input[name='db_password']").val()),t.jdbc_string=$("#data-connect-add-form input[name='jdbc_string']").val(),t.max_connect_count=$("#data-connect-add-form input[name='max_connect_count']").val(),t.driverInfo=$("#connection_type option:selected").attr("className"),App.blockUI({boxed:!0,message:"新增中..."}),r.addDataConnectList(t)}),$("body").on("click","#data-source-configuration .data-source-configuration-list li a",function(t){t.stopPropagation(),$("#data-source-configuration .data-source-configuration-list li").removeClass("click-add-background"),$(this).closest("li").addClass("click-add-background");var e=$(this).data("params");if($("#J_dsc_list_detail_title_type span").html(e.connection_name+"<span> / "+e.connection_type+"</span>"),-1<e.connection_type.indexOf("文件"))return r.clearFileBlock(),r.hideShowBlock("#J_dsc_fileType_add"),r.getExcelFileTypeData({connectionId:e.connect_id}),!(r.fileEdit=!0);r.hideShowBlock("#J_dsc_commonType_edit"),r.getConnectType_edit(e.connection_type),console.log(r.list),r.connect_id=e.connect_id,r.db_password=e.db_password,$("#connection_type_edit").val(e.connection_type),$("#connection_name_edit").val(e.connection_name),$("#data-connect-edit-form input[name='connection_desc']").val(e.connection_desc),$("#data-connect-edit-form input[name='server']").val(e.server),$("#data-connect-edit-form input[name='db_port']").val(e.db_port),$("#data-connect-edit-form input[name='db_database']").val(e.db_database),$("#data-connect-edit-form input[name='db_user']").val(e.db_user),$("#data-connect-edit-form input[name='db_password']").val(e.db_password),$("#data-connect-edit-form input[name='jdbc_string']").val(e.jdbc_string),$("#data-connect-edit-form input[name='max_connect_count']").val(e.max_connect_count)}),$("body").on("click","#data-source-configuration #data-connect-edit-submit",function(){if(!$("#data-connect-edit-form").validate().form())return!1;var t={};t.connection_id=r.connect_id,t.connection_name=$("#connection_name_edit").val(),t.connection_desc=$("#data-connect-edit-form input[name='connection_desc']").val(),t.connection_type=$("#connection_type_edit").val(),t.server=$("#data-connect-edit-form input[name='server']").val(),t.db_port=$("#data-connect-edit-form input[name='db_port']").val(),t.db_database=$("#data-connect-edit-form input[name='db_database']").val(),t.db_user=$("#data-connect-edit-form input[name='db_user']").val(),t.jdbc_string=$("#data-connect-edit-form input[name='jdbc_string']").val(),t.max_connect_count=$("#data-connect-edit-form input[name='max_connect_count']").val(),t.driverInfo=$("#connection_type_edit option:selected").attr("className"),r.db_password&&r.db_password==$("#data-connect-edit-form input[name='db_password']").val()?t.db_password=r.db_password:t.db_password=$.des.getDes($("#data-connect-edit-form input[name='db_password']").val()),App.blockUI({boxed:!0,message:"修改中..."}),r.editDataConnectList(t)}),$("body").on("click","#data-source-configuration .data-source-configuration-list li .delBtn",function(){var e={};e.connection_id=$(this).attr("connection_id"),e.opType="del",e.driver_id=$(this).attr("driver_id"),bootbox.confirm("确定删除吗?",function(t){t&&(App.blockUI({boxed:!0,message:"删除中..."}),r.deleteDataConnect(e))})}),$("body").on("click","#data-source-configuration #J_edit_test_submit",function(){if(!$("#data-connect-edit-form").validate().form())return!1;var t={};t.connection_name=$("#connection_name_edit").val(),t.connection_desc=$("#data-connect-edit-form input[name='connection_desc']").val(),t.connection_type=$("#connection_type_edit").val(),t.server=$("#data-connect-edit-form input[name='server']").val(),t.db_port=$("#data-connect-edit-form input[name='db_port']").val(),t.db_database=$("#data-connect-edit-form input[name='db_database']").val(),t.db_user=$("#data-connect-edit-form input[name='db_user']").val(),t.jdbc_string=$("#data-connect-edit-form input[name='jdbc_string']").val(),t.max_connect_count=$("#data-connect-edit-form input[name='max_connect_count']").val(),t.driverInfo=$("#connection_type_edit option:selected").attr("className"),r.db_password&&r.db_password==$("#data-connect-edit-form input[name='db_password']").val()?t.db_password=r.db_password:t.db_password=$.des.getDes($("#data-connect-edit-form input[name='db_password']").val()),App.blockUI({boxed:!0,message:"测试中..."}),r.testDataConnectList(t)}),$("body").on("click","#data-source-configuration #data_connect_import_btn",function(){$("#dsc-seach-metadata-input").val(""),$("#data_connect_import_modal").modal("show");var t=$(".data-source-configuration-list .click-add-background").attr("connection_id");App.blockUI({boxed:!0,message:"正在查询"}),r.getImportDataSource(t)}),$("body").on("change","#data-source-configuration #data-connect-edit-form input[name='db_database']",function(){$("#data-connect-edit-form input[name='jdbc_string']").val()}),$("body").on("change","#data-source-configuration #connection_type",function(){var a,n=$(this).find("option:selected").attr("driverid");$.each(r.getConnectTypeData,function(t,e){e.driverId===n&&($("#data-connect-add-form input[name='db_port']").val(e.dbPort),a=e.urlInfo)}),"CDH"==$(this).find("option:selected").html()?$("#data-connect-add-form input[name='principal']").closest(".form-group").removeClass("hide"):$("#data-connect-add-form input[name='principal']").closest(".form-group").addClass("hide");var t=$("#data-connect-add-form input[name='db_port']").val(),e=a;-1<e.indexOf("{host}:{port}")&&($("#data-connect-add-form input[name=jdbc_string]").val(e),e=e.replace("{port}",t)),$("#data-connect-add-form input[name=jdbc_string]").val(e),$("#J_dsc_list_detail_title_type span").html("新增连接<span> / "+$(this).find("option:selected").html()+"</span>"),$("#J_dsc_commonType_add input[name=jdbc_string]").attr("disabled","disabled"),$("#isUrlinfoDisable-add").closest("span").removeClass("checked"),-1<a.indexOf("{host}:{port}")||($("#J_dsc_commonType_add input[name=jdbc_string]").removeAttr("disabled"),$("#isUrlinfoDisable-add").closest("span").addClass("checked")),r.currentUrlInfo=a}),$("body").on("change","#data-source-configuration #connection_type_edit",function(){var t=$(this).find("option:selected").attr("urlinfo"),a=$(this).find("option:selected").attr("driverid");$("#data-connect-edit-form input[name='jdbc_string']").val(t),$.each(r.getConnectTypeData,function(t,e){e.driverId===a&&$("#data-connect-edit-form input[name='db_port']").val(e.dbPort)}),$("#data-connect-edit-form input[name='jdbc_string']").attr("disabled","disabled"),$("#isUrlinfoDisable-edit").closest("span").removeClass("checked");var e=$("#data-connect-edit-form input[name='jdbc_string']").val();if(-1<e.indexOf("{host}:{port}")){var n=$("#data-connect-edit-form input[name='server']").val(),o=$("#data-connect-edit-form input[name='db_port']").val(),c=$("#data-connect-edit-form input[name='db_database']").val();n&&(e=e.replace("{host}",n)),o&&(e=e.replace("{port}",o)),c&&(e=e.replace("{database}",c)),$("#data-connect-edit-form input[name='jdbc_string']").val(e)}else $("#data-connect-edit-form input[name=jdbc_string]").removeAttr("disabled"),$("#isUrlinfoDisable-edit").closest("span").addClass("checked")}),$("body").on("change","#data-source-configuration #isUrlinfoDisable-add",function(){"checked"===$("#isUrlinfoDisable-add").closest("span").attr("class")?$("#J_dsc_commonType_add input[name=jdbc_string]").removeAttr("disabled"):$("#J_dsc_commonType_add input[name=jdbc_string]").attr("disabled","disabled")}),$("body").on("change","#data-source-configuration #isUrlinfoDisable-edit",function(){"checked"===$("#isUrlinfoDisable-edit").closest("span").attr("class")?$("#data-connect-edit-form input[name=jdbc_string]").removeAttr("disabled"):$("#data-connect-edit-form input[name=jdbc_string]").attr("disabled","disabled")}),$("body").on("blur","#data-source-configuration #data-connect-add-form input[name='server'],#data-connect-add-form input[name='db_port'],#data-connect-add-form input[name='db_database']",function(){var t=r.currentUrlInfo;if(!(-1<t.indexOf("{host}:{port}")))return!1;var e=$("#data-connect-add-form input[name='server']").val(),a=$("#data-connect-add-form input[name='db_port']").val(),n=$("#data-connect-add-form input[name='db_database']").val();e&&(t=t.replace("{host}",e)),a&&(t=t.replace("{port}",a)),n&&(t=t.replace("{database}",n));var o=$("#J_dsc_commonType_add input[name=principal]").val();""!=o?$("#J_dsc_commonType_add input[name=jdbc_string]").val(t+";principal="+o):$("#J_dsc_commonType_add input[name=jdbc_string]").val(t)}),$("body").on("blur","#data-source-configuration #data-connect-edit-form input[name='server'],#data-source-configuration #data-connect-edit-form input[name='db_port'],#data-source-configuration #data-connect-edit-form input[name='db_database']",function(){var t=$("#connection_type_edit").find("option:selected").attr("urlinfo");if(!(-1<t.indexOf("{host}:{port}")))return!1;var e=$("#data-connect-edit-form input[name='server']").val(),a=$("#data-connect-edit-form input[name='db_port']").val(),n=$("#data-connect-edit-form input[name='db_database']").val();e&&(t=t.replace("{host}",e)),a&&(t=t.replace("{port}",a)),n&&(t=t.replace("{database}",n)),$("#data-connect-edit-form input[name='jdbc_string']").val(t)}),$("body").on("click","#data-source-configuration #import_submit",function(){var t=$.kingdom.uniqueArray($("#J_tree_import").jstree("get_checked"));$.each(t,function(t,e){-1===e.indexOf("child")&&0===$("#"+e+" > ul").length&&($("#"+e+" > i").click(),$("#"+e+" > ul").addClass("jstree-hide"))}),r.saveTableList()}),$("body").on("click","#data-source-configuration #dsc-delete-table",function(){if(0===$("#J_data_connect_table .checked").length)return toastr.info("请勾选需要操作的对象"),!1;bootbox.confirm("确定删除吗?",function(t){t&&(App.blockUI({boxed:!0,message:"删除中..."}),r.deleteTableList())})}),$("body").on("click","#data-source-configuration #dsc-tables-upd",function(){if(0===$("#J_data_connect_table .checked").length)return toastr.info("请勾选需要操作的对象"),!1;bootbox.confirm("确定同步吗?",function(t){t&&(App.blockUI({boxed:!0,message:"同步中..."}),r.metadataTablesUpd())})}),$("body").on("click","#data-source-configuration #dsc-table_recordcount_upd",function(){if(0===$("#J_data_connect_table .checked").length)return toastr.info("请勾选需要操作的对象"),!1;bootbox.confirm("确定更新吗?",function(t){t&&(App.blockUI({boxed:!0,message:"更新中..."}),r.tableRecordcountUpd())})}),$("body").on("click","#data-source-configuration #dsc-tables-upd-batch",function(){bootbox.confirm("确定批量同步吗?",function(t){if(t){App.blockUI({boxed:!0,message:"同步中..."});var e=$(".data-source-configuration-list .click-add-background").attr("connection_id");r.metadataTablesUpdBatch({allCheckFlag:"Y",connection_id:e})}})}),$("body").on("click","#data-source-configuration #dsc-table_recordcount_upd_batch",function(){bootbox.confirm("确定批量更新吗?",function(t){if(t){App.blockUI({boxed:!0,message:"更新中..."});var e=$(".data-source-configuration-list .click-add-background").attr("connection_id");r.tableRecordcountUpdBatch({allCheckFlag:"Y",connection_id:e})}})}),$("body").on("click","#J_list_export",function(){r.listImport({connection_id:r.connect_id,tableId:""}).then(function(t){return r.listImport2({fileClass:"ZIP",filePath:t.bcjson.items[0].filePatch}).then(function(t){return r.listImport3({fileClass:"ZIP",downloadToken:t.bcjson.items[0].downloadToken,_s_t_i_0000:$.kingdom.getValue("x-trace-user-id")})})})}),$("body").on("click","#data-source-configuration #dsc-modal-check",function(){$("#des-table-info-modal").modal("show"),$("#des-table-info-modal ul li a:eq(0)").click(),$("#des-table-info-modal #des-showtable-info-1-form input[name='tableName']").val($(this).closest("td").data("tablename")),$("#des-table-info-modal #des-showtable-info-1-form input[name='tableCat']").val($(this).closest("td").data("tablecat")),$("#des-table-info-modal #des-showtable-info-1-form input[name='mdType']").val($(this).closest("td").data("mdtype")),$("#des-table-info-modal #des-showtable-info-1-form input[name='tableDesc']").val($(this).closest("td").data("tabledesc")),$("#des-table-info-modal #des-showtable-info-1-form input[name='schemName']").val($(this).closest("td").data("schemname")),r.getTabColumnInfo($(this).closest("td").data("tableid")),$("#des-showtable-info-3-button").attr("tablename",$(this).closest("td").data("tablename")),$("#des-showtable-info-3-button").attr("schemname",$(this).closest("td").data("schemname")),$("#des-showtable-info-3-table-body").html(""),$("#des-showtable-info-3-thead-tr").html(""),$("#des-showtable-info-3-table").siblings("img").remove(),$("#des-showtable-info-3-button").click()}),$("body").on("click","#data-source-configuration #dsc-modal-delete",function(){var e=$(this).closest("td").data("tableid");bootbox.confirm("确定删除吗?",function(t){t&&(App.blockUI({boxed:!0,message:"删除中..."}),r.deleteTableList(!0,e))})}),$("body").on("click","#data-source-configuration #des-showtable-info-3-button",function(){var t=$(this).attr("tablename"),e=$(this).attr("schemname");r.previewAction(e,t)}),$("body").on("keydown","#data-source-configuration #dsc-seach-metadata-input",function(t){13==t.keyCode&&$("#data-source-configuration #dsc-seach-metadata").click()}),$("body").on("click","#data-source-configuration #dsc-seach-metadata",function(){var o=$("#data-source-configuration #dsc-seach-metadata-input").val().toUpperCase(),c=[];$.each(r.getCurrentTreeData,function(t,e){var a=$.extend({},e),n=[];$.each(a.tableList,function(t,e){n.push(e)}),a.tableList=n,c.push(a)}),$.each(c,function(t,e){for(var a=0,n=e.tableList.length;a<n;a++)e.tableList[a]&&e.tableList[a].tableName.toUpperCase().indexOf(o)<=-1&&e.tableList.splice(a--,1);e.tableCounts=e.tableList.length.toString()}),r.generateTree(c,!0)}),$("body").on("click","#data-source-configuration #J_dsc_add_file",function(){$("#J_mock_form_collection input[type=file]").click()}),$("body").on("change","#data-source-configuration #J_mock_form_collection_form input[name='file']",function(t){var e=t.currentTarget.files[0].name.split("."),a=e[e.length-1];"xls"===a||"xlsx"===a?(App.blockUI({boxed:!0,message:"上传中..."}),r.upLoad(t.currentTarget.files[0].name,a)):toastr.info("暂只支持xls或xlsw文件类型")}),$("body").on("click","#data-source-configuration .excel-choose-block-inside ul li .glyphicon-trash",function(){$("#J_mock_form_collection_form input[name='file']").val(""),$(this).closest("li").remove(),$("#data-source-configuration .excel-bottom span span").html($("#data-source-configuration .excel-choose-block-inside ul li").length),$("#J_dsc_produce_head").html(""),$("#J_dsc_produce_body").html(""),$("#J_dsc_produce_head_option").html(""),$("#J_dsc_produce_body_option").html(""),$("#J_dsc_produce_head").closest(".table-scrollable").toggleClass("hide"),r.getExcelContentList()}),$("body").on("click","#data-source-configuration #J_dsc_clear_file",function(){$("#J_mock_form_collection_form input[name='file']").val(""),$("#data-source-configuration .excel-choose-block-inside ul li").remove(),$("#data-source-configuration .excel-bottom span span").html("0"),$("#J_dsc_produce_head").html(""),$("#J_dsc_produce_body").html(""),$("#J_dsc_produce_head_option").html(""),$("#J_dsc_produce_body_option").html(""),$("#J_dsc_produce_head").closest(".table-scrollable").addClass("hide"),r.getExcelContentList()}),$("body").on("change","#J_select2_dcs_target_data_connect",function(t){r.getTableList({connection_id:t.currentTarget.value},"#J_select2_des_target_object",!1,function(){if(r.targetTable){var t=$("#J_select2_des_target_object").data("origin"),e=!0,a=!1,n=void 0;try{for(var o,c=t[Symbol.iterator]();!(e=(o=c.next()).done);e=!0){var d=o.value,i=d.id;d.text===r.targetTable&&$("#J_select2_des_target_object").val(i).change()}}catch(t){a=!0,n=t}finally{try{!e&&c.return&&c.return()}finally{if(a)throw n}}}else $("#J_select2_des_target_object").change();r.targetTable=""})}),$("body").on("click","#data-source-configuration [name=dataTimeType]",function(){var t=$(this).val(),e={rtl:!1,orientation:"left",todayBtn:"linked",autoclose:!0,language:"zh-CN",todayHighlight:!0,startView:2,maxViewMode:2,minViewMode:2,format:"yyyy"};"0"==t?(e.startView=0,e.maxViewMode=0,e.minViewMode=0,e.format="yyyymmdd"):"1"==t?(e.startView=1,e.maxViewMode=1,e.minViewMode=1,e.format="yyyymm"):(e.startView=2,e.maxViewMode=2,e.minViewMode=2,e.format="yyyy",$(this).val(t.substring(0,4))),jQuery().datepicker&&($("[name=dataTime]").datepicker("remove"),$("[name=dataTime]").datepicker(e),$("[name=dataTime]").datepicker("setDate",new Date))}),$("body").on("click","#data-source-configuration #J_excel_add_tab3_btn [data-type]",function(){var t=$(this).data("type"),e=$("#J_excel_add_tab2_form select[name='targetTable']").val();"refresh"===t?r.getDataField_2({table_id:e}):"del"===t&&r.haddleDataField_2.delCheckedRow()}),$("body").on("change","#J_excel_add_tab1 input[name=headType]",function(){"0"===$(this).val()?($("#J_dsc_produce_table").removeClass("hide"),$("#J_dsc_produce_table_option").addClass("hide")):($("#J_dsc_produce_table").addClass("hide"),$("#J_dsc_produce_table_option").removeClass("hide"))}),$("body").on("click","#data-source-configuration #J_dsc_pre_step",function(){var t=$("#J_dsc_fileType_add li").index($("#J_dsc_fileType_add li.active"));if(0===t)return!1;1===t?($("#data-source-configuration #J_dsc_fileType_add .tabbable-line li").removeClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li:eq(0)").addClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tab-pane").removeClass("active"),$("#data-source-configuration #J_excel_add_tab1").addClass("active")):2===t&&($("#data-source-configuration #J_dsc_fileType_add .tabbable-line li").removeClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li:eq(1)").addClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tab-pane").removeClass("active"),$("#data-source-configuration #J_excel_add_tab2").addClass("active"))}),$("body").on("click","#data-source-configuration #J_dsc_next_step",function(){var t=$("#J_dsc_fileType_add li").index($("#J_dsc_fileType_add li.active")),e={},a=$("#data-source-configuration #J_excel_add_tab1 input[name='connectionName']").val();e.connectionName=a;var n=$("#data-source-configuration #J_excel_add_tab1 .excel-choose-block-inside li:eq(0) span"),o=n.html(),c=n.attr("fileurl"),d=n.attr("type");e.fileName=o,e.fileUrl=c,e.fileType=d;var i="",s=$("#J_excel_add_tab1 input[name=headType]:checked").val();if(i="0"===s?"0":($.each($("#J_dsc_produce_table_option input[type=checkbox]:checked"),function(){i=i+$("#J_dsc_produce_table_option input[type=checkbox]").index($(this))+","}),i.substring(0,i.length-1)),e=_extends(e,App.getFormParams("J_excel_add_tab2_form")),$("#J_excel_add_tab2_form select[name='targetTable']").val()&&(e.targetTable=$("#J_excel_add_tab2_form select[name='targetTable']").select2("data")[0].text.replace("(表)","")),e.mappingInfo=r.haddleDataField_2.getData(),0===t){if(!a)return toastr.info("连接名称不能为空"),!1;if(0===$("#data-source-configuration #J_excel_add_tab1 .excel-choose-block-inside li").length)return toastr.info("请上传文件"),!1;$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li").removeClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li:eq(1)").addClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tab-pane").removeClass("active"),$("#data-source-configuration #J_excel_add_tab2").addClass("active")}else 1===t?(r.getDataField_2({table_id:$("#J_excel_add_tab2_form select[name='targetTable']").val()}),$("#data-source-configuration a[href='#J_excel_add_tab3']").click(),$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li").removeClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tabbable-line li:eq(2)").addClass("active"),$("#data-source-configuration #J_dsc_fileType_add .tab-pane").removeClass("active"),$("#data-source-configuration #J_excel_add_tab3").addClass("active")):2===t&&(e.DBTYPE="FILE",e.connectionType=$("#connection_type").val(),e.headLine=i,r.fileEdit&&(e.opType="UPD",e.connectionId=$("#data-source-configuration .data-source-configuration-list .click-add-background").attr("connection_id")),r.addDataConnectList(e))}),$("body").on("click","#data-source-configuration #J_file_data_result_body #dsc-modal-check-file",function(){var t=$(this).closest("td"),e={connectionId:t.attr("connectionid"),fileUrl:t.attr("fileurl"),fileType:t.attr("filetype"),fileName:t.attr("filename")};r.hideShowBlock("#J_dsc_file_list_single_detail"),$("#data-source-configuration #J_dsc_back_to_list").removeClass("hide"),r.getExcelSingleFileDetail(e)}),$("body").on("click","#data-source-configuration #J_single_file_data_result_body a",function(){var o=$(this).closest("tr").find("td");if("编辑"===$(this).html())$.each(o,function(t,e){if(t!==o.length-1){var a=$(e).html(),n=$(e).width();$(e).html("<input type='text' style='width:"+n+"px'/>"),$(e).find("input").val(a)}else $(e).html("<a href='javascript:;'>保存</a>")});else{var n=JSON.parse($(this).closest("tr").attr("currentdata")),t=$(this).closest("tr").find("input"),c=[];$.each(t,function(t,e){var a={};c.push(a),a.key=$(e).closest("td").attr("currentkey"),a.val=$(e).val(),$(e).val()===n[a.key]?a.isTrans=0:a.isTrans=1}),App.blockUI({boxed:!0,message:"保存中..."});var e=JSON.parse($(this).closest("table").find("thead tr").attr("currentpreparams"));e.dataInfo=c,r.editExcelSingleFileDetail(e)}}),$("body").on("click","#data-source-configuration #J_dsc_back_to_list",function(){r.hideShowBlock("#J_dsc_file_list_detail")})}),module.exports=t});