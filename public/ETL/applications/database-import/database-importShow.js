var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};define(function(require,exports,module){require("plugins/jstree/dist/jstree"),require("plugins/jstree/dist/themes/default/style.css"),require("plugins/select2/js/select2.js"),require("plugins/select2/css/select2.css"),require("plugins/select2/css/select2-compatible.css"),require("assets/js/global/tableTree"),require("assets/js/global/tableTree1");var r={};function n(e){var t=[{id:"1",pId:"-1",columns:{Name:"资料管理",Type:"",Description:"",Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]}];for(var o in e){var n={id:o,pId:"1",attr:{objectType:e[o][0].objectType},columns:{Name:e[o][0].objectTypeName,Type:"",Description:"",Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]};t[0].children.push(n)}for(var r=t[0].children,c=0,a=r.length;c<a;c++){var p=[],i=!0,s=!1,l=void 0;try{function d(){var d=u.value;for(var e in d)d[e]=d[e].replace(/\"/g,"&quot;"),d[e]=d[e].replace(/\'/g,"&apos;");if(console.log(d.objectName),d.folderName)!function(){function e(o){if(d.folderId=i[o]||"",d.folderName=a[o]||"",d.parentFolderId=i[0],0===o)l=(s=(0<p.length&&p.map(function(e){return e.id===d.folderId[o]}).includes(!0)||p.push({id:i[o],pId:d.objectType,attr:{obj:JSON.stringify(d)},columns:{Name:a[o],Type:"",Description:"",Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]}),p),i[o]);else if(o<a.length){var n=void 0,e=void 0;if(s.map(function(e,t){if(e.id===i[o-1])return n=t}),0<(e=s[n].children).length){var t=!1;e.map(function(e){return e.id===i[o]&&(t=!0)}),l=(s=(t||e.push({id:i[o],pId:l,attr:{obj:JSON.stringify(d)},columns:{Name:a[o],Type:"",Description:"",Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]}),e),i[o])}else e.push({id:i[o],pId:l,attr:{obj:JSON.stringify(d)},columns:{Name:a[o],Type:"",Description:"",Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]}),s=e,l=i[o]}else{var r=void 0,c=void 0;s.map(function(e,t){if(e.id===i[o-1])return r=t}),c=s[r].children,d.folderIds="",c.push({id:d.objectId,pId:l,attr:{obj:JSON.stringify(d)},columns:{Name:d.objectName,Type:d.objectClassTypeName,Description:d.objectDesc,Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]})}}for(var a=d.folderName.split("/"),i=d.folderIds.split(","),s=[],l="",t=0;t<=a.length;t++)e(t);r[c].children=p}();else{var t={id:d.objectId,pId:d.objectType,attr:{obj:JSON.stringify(d)},columns:{Name:d.objectName,Type:d.objectClassTypeName,Description:d.objectDesc,Action:{formatter:function(){return'<a name="export" title="EXPORT">EXPORT</a>'}}},children:[]};r[c].children.push(t)}}for(var u,m=e[r[c].id][Symbol.iterator]();!(i=(u=m.next()).done);i=!0)d()}catch(e){s=!0,l=e}finally{try{!i&&m.return&&m.return()}finally{if(s)throw l}}}return t}r._load=function(){r.getDataSourceList(),r.getList(),r.initForm(),App.handleDateTimePickers()},r.unScroll=function(){var t=$(document).scrollTop();$(document).on("scroll.unable",function(e){$(document).scrollTop(t)})},r.reScroll=function(){$(document).off("scroll.unable")},r.getList=function(){var e=App.getFormParams("J_export_list_form");$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_config_export_list","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(0===t.length)return void $("#J_source_tree").html('<div class="no-data">No Data</div>');var o=n(t[0]);$("#J_table_tree").tableTree({checkbox:!0,data:o}).openNode("1"),$("#J_table_tree thead tr th:first-child").css("width","50px"),$("#J_table_tree thead tr th:nth-child(2)").css("text-indent","100px")}})},r.filterCondition=function(){return checkedLevel2=$("#J_table_tree [level=2] [type=checkbox]:checked"),checkedLevel1=$("#J_table_tree [level=1] [type=checkbox]:checked"),level2=$("#J_table_tree [level=2] [type=checkbox]"),checkedAll=$("#J_table_tree [type=checkbox]:checked"),arr3=[],arr2=[],checkedLevel2&&$.each(checkedLevel2,function(){arr2.push($(this).closest("tr").attr("key"))}),checkedAll.length&&$.each(checkedAll,function(){var e="",t=$(this).closest("tr");if($(this).attr("obj")&&(e=JSON.parse($(this).attr("obj"))),e&&!e.folderName){var o=void 0,n=void 0;if(n=(o=e.parentFolderId?$("#J_table_tree [key="+e.parentFolderId+"] [type=checkbox]").closest("tr").attr("pkey"):t.attr("pkey"),$("#J_table_tree [key="+o+"] [type=checkbox]:checked").attr("objecttype")),!arr2.includes(n)){var r=e,c=r.objectType,a=r.objectClassTypeName,i=r.objectId,s=r.objectTypeName,l=r.objectName,d=r.tableName,p=r.columnsId,u=r.objectClassType,m=r.folderId,f=r.folderIds;arr3.push({objectType:c,objectId:i,objectName:l,tableName:d,columnsId:p,objectClassType:u,folderId:m,objectTypeName:s,objectClassTypeName:a,folderIds:f})}}}),checkedLevel2.length&&$.each(checkedLevel2,function(){var e=$(this).attr("objecttype");arr2.includes(e)||arr2.push(e)}),0<checkedLevel1.length&&level2.length&&$.each(level2,function(){var e=$(this).attr("objecttype");arr2.includes(e)||arr2.push(e)}),objectType=arr2.join(","),{objectType:objectType,objectList:JSON.stringify(arr3)}},r.filterConditionImport=function(c){var e=$("#execDbConnection_"+c+" [level=3] [type=checkbox]:checked"),a=($("#execDbConnection_"+c+" [level=2] [type=checkbox]:checked"),$("#execDbConnection_"+c+" [level=1] [type=checkbox]:checked"),$("#execDbConnection_"+c+" [level=2] [type=checkbox]"),[]);return e.length&&$.each(e,function(){var e=JSON.parse($(this).attr("obj")),t=$(this).closest("tr").attr("pkey"),o=($("#execDbConnection_"+c+" [key="+t+"] [type=checkbox]:checked").attr("objecttype"),e.objectType),n=e.objectId,r=e.folderIds;a.push({objectType:o,objectId:n,folderIds:r})}),{configList:JSON.stringify(a)}},r.export=function(e){App.blockUI({boxed:!0,message:"Processing..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.export_sys_config","v4.0",e,function(e){"1"==e.bcjson.flag?($("#J_export_success_modal").modal("show"),$("#J_edit_fileName_modal").modal("hide")):toastr.error(e.bcjson.msg),App.unblockUI()})},r.import=function(e){App.blockUI({boxed:!0,message:"Processing..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_config_info_import_v2","v4.0",e,function(e){"1"==e.bcjson.flag?(toastr.success(e.bcjson.msg),$("#J_import_modal").modal("hide")):toastr.error(e.bcjson.msg),App.unblockUI()})},r.downloadFile=function(o){return new Promise(function(t,e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.file_info","v4.0",o,function(e){"1"==e.bcjson.flag?t(e):(App.unblockUI(),toastr.error(e.bcjson.msg))})})},r.downloadFile2=function(e){var t="/retl/rest/admin/v4.0/bayconnect.superlop.file_download.json?p="+encodeURI(JSON.stringify(e));try{var o=document.createElement("a");o.href=t,o.download=t,o.click(),App.unblockUI()}catch(e){console.error(e)}},r.reExport=function(e){App.blockUI({boxed:!0,message:"Processing..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_re_download_sys_config","v4.0",e,function(e){"1"==e.bcjson.flag?(r.getExportList(),$("#J_export_success_modal").modal("show"),$("#J_edit_fileName_modal").modal("hide")):toastr.error(e.bcjson.msg),App.unblockUI()})},r.getImportList=function(){App.blockUI({boxed:!0,message:"Processing..."}),$.kingdom.uploadWithApi("J_import_form","get_sys_config_import_list",function(e){if(App.unblockUI(),"1"==e.bcjson.flag){toastr.success(e.bcjson.msg);var n=e.bcjson.items;$("#J_import_modal .nav-tabs").html(""),$("#J_import_modal .tab-content").html(""),r.deZipPaths=[],$.each(n,function(e,t){r.deZipPaths.push(t.deZipPath),$("#J_import_modal .nav-tabs").append(' <li>\n                    <a href="#tab_3_'+e+'" data-toggle="tab" aria-expanded="true">'+t.fileName+" </a>\n                </li>"),$("#J_import_modal .tab-content").append('\n                <div class="tab-pane" id="tab_3_'+e+'"> \n                <div class="row">\n                 <div class="form-group" >\n                    <div style="padding: 0 20px 0 80px;">\n                    <div class="col-md-11" style="max-height: 400px;overflow:auto;">\n                    <table id="execDbConnection_'+e+'"  class="table table-hover table-tree" style="max-height:800px;over-flow:auto">\n                    </table>\n                  </div>\n                 </div>\n                        </div>\n                </div> \n                </div>\n                ');var o=function(e){var t=[{id:"1",pId:"-1",columns:{Name:"资料管理",Type:"",Description:""},children:[]}];for(var o in e){var n={id:o,pId:"1",attr:{objectType:e[o][0].objectType},columns:{Name:e[o][0].objectTypeName,Type:e[o][0].objectClassTypeName,Description:e[o][0].objectDesc},children:[]};t[0].children.push(n)}for(var r=t[0].children,c=0,a=r.length;c<a;c++){var i=!0,s=!1,l=void 0;try{for(var d,p=e[r[c].id][Symbol.iterator]();!(i=(d=p.next()).done);i=!0){var u=d.value,m={id:u.objectId,pId:u.objectType,attr:{obj:JSON.stringify(u)},columns:{Name:u.objectName,Type:u.objectClassTypeName,Description:u.objectDesc},children:[]};r[c].children.push(m)}}catch(e){s=!0,l=e}finally{try{!i&&p.return&&p.return()}finally{if(s)throw l}}}return t}(n[e].configInfoList);$("#execDbConnection_"+e).TableTree1({checkbox:!0,data:o}).openNode("1"),$("#execDbConnection_"+e+" thead tr th:nth-child(2)").css("text-indent","100px")}),$("#J_import_modal .nav-tabs li").eq(0).addClass("active").css("margin-left","80px"),$("#J_import_modal .tab-content .tab-pane").eq(0).addClass("active")}else toastr.error(e.bcjson.msg)})},r.getDataSourceList=function(){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_data_source_config","v4.0",{},function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,o=[{id:"",text:""}];if(t&&0<t.length){var n=!0,r=!1,c=void 0;try{for(var a,i=t[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var s=a.value;o.push({id:s.connectionId,text:s.connectionName})}}catch(e){r=!0,c=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw c}}}$("[name=execDbConnectionId]").select2({data:o,placeholder:"- Please Select -"})}})},r.getExportList=function(e){var t={};t=_extends(t,e),$.kingdom.getList({apiName:"bayconnect.superlop.get_sys_config_import_log",apiVision:"v4.0",params:t,tableId:"J_export_list",pageId:"J_export_page",formName:"J_export_form",template:"database-import/template/export-list.handlebars",cb:r.getExportList})},r.del=function(e){App.blockUI({boxed:!0,message:"处理中..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_sys_config_data_log_del","v4.0",e,function(e){"1"==e.bcjson.flag?(toastr.success(e.bcjson.msg),r.getExportList()):toastr.error(e.bcjson.msg),App.unblockUI()})},r.downloadLog=function(e,t){var o=new Blob([t],{type:"txt"}),n=document.getElementById("downloadFtsetBtn");null==n&&((n=document.createElement("a")).id="downloadFtsetBtn",n.style.display="none",n.target="_blank",document.body.appendChild(n));try{var r=window.URL||window.webkitURL;n.href=r.createObjectURL(o),n.download=e,"function"==typeof navigator.msSaveBlob&&navigator.msSaveBlob(o,e),n.click()}catch(e){console.error(e)}},r.timestampToTime=function(){var e=new Date;return e.getFullYear()+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+(e.getDate()<10?"0"+e.getDate():e.getDate())+(e.getHours()<10?"0"+e.getHours():e.getHours())+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},r.initForm=function(){$("#J_edit_fileName").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{fileName:{required:!0,isEditFileName:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_reExport_edit_fileName").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{fileName:{required:!0,isEditFileName:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$.validator.addMethod("isEditFileName",function(e,t){return!!/^[^\\\/:\*\?\"\<\>\|]{0,50}$/.test(e)},'名称不超过50个字符且不能包含以下字符：\\ / : * ? " <> | ')},module.exports=r});