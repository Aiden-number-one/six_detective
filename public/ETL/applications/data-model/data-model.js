define(function(require,exports,module){var d=require("./data-modelShow"),_=location.hash.replace("#",".page-"),a={load:function(){d._load();var a=document.getElementById("J_drag_bar4"),t=document.getElementById("J_drag_bar4");startDrag(a,t,".left-side-model",".right-content-model",function(){LFWIDTH=$(".left-side").width()})}};$(function(){$("body").on("click",_+" #J_dataModel_tree .jstree-ocl",function(){App.treeEllipsis("#J_dataModel_tree")}),$("body").on("click",_+" #J_dataModel_tree .jstree-anchor",function(){d.getTaskList(),d.getDataModel()}),$("body").on("click",_+" #J_dataModel_add",function(){var a=0;if($.each($(_+" #J_dataModal_list tr"),function(){if("1"==$(this).attr("edit"))return!(a=1)}),1==a)return toastr.warning("请先保存未保存的数据"),!1;var t={addNew:"1"};if($(_+" #J_dataModal_list tr:last-child").hasClass("lastTr"))t.isNull=0,t.tableId="",t.chianeseName="",t.englishName="",t.folderId="",t.dbTablespace="",t.dbUser="",t.dictId="",t.remark="";else{var e=$(_+" #J_dataModal_list tr:last-child");t.isNull=1,t.tableId=e.attr("tableId"),t.chianeseName=e.attr("chianeseName"),t.englishName=e.attr("englishName"),t.folderId=e.attr("folderId"),t.dbTablespace=e.attr("dbTablespace"),t.dbUser=e.attr("dbUser"),t.dictId=e.attr("dictId"),t.remark=e.attr("remark")}d.treeData(t)}),$("body").on("click",_+" #J_dataModal_list .J_dataModel_save",function(a){a.preventDefault(),a.stopPropagation();var t={};return t.tr=$(this).parent().parent(),t.basicId=t.tr.attr("basicId"),t.tableId=$(_+" #J_dataModal_list input:eq(0)").val(),t.chianeseName=$(_+" #J_dataModal_list input:eq(1)").val(),t.englishName=$(_+" #J_dataModal_list input:eq(2)").val(),t.folderId=$(_+" #J_dataModal_list .foldername select").val(),t.folderName=$(_+" #J_dataModal_list .foldername [value="+t.folderId+"]").html(),t.dbTablespace=$(_+" #J_dataModal_list input:eq(3)").val(),t.dictId=$(_+" #J_dataModal_list .dictname select").val(),t.dictName=$(_+" #J_dataModal_list .dictname [value="+t.dictId+"]").html(),t.dbUser=$(_+" #J_dataModal_list input:eq(4)").val(),t.remark=$(_+" #J_dataModal_list input:eq(5)").val(),t.addNew=t.tr.attr("addNew"),t.tableId?t.chianeseName?t.englishName?t.dbTablespace?t.dbUser?(params={},"1"==t.addNew?params.operType="ADD":params.operType="UPD",params.tableId=t.tableId,params.basicId=t.basicId,params.folderId=t.folderId,params.chianeseName=t.chianeseName,params.englishName=t.englishName,params.dictId=t.dictId,params.dbTablespace=t.dbTablespace,params.dbUser=t.dbUser,params.remark=t.remark,void d.setModify(params,t)):(toastr.error("表用户不能为空"),$(_+" #J_dataModal_list input:eq(4)").focus(),!1):(toastr.error("表空间不能为空"),$(_+" #J_dataModal_list input:eq(3)").focus(),!1):(toastr.error("表英文名称不能为空"),$(_+" #J_dataModal_list input:eq(2)").focus(),!1):(toastr.error("表中文名称不能为空"),$(_+" #J_dataModal_list input:eq(1)").focus(),!1):(toastr.error("编号不能为空"),$(_+" #J_dataModal_list input:eq(0)").focus(),!1)}),$("body").on("click",_+" #J_dataModal_list .J_dataModel_edit",function(a){a.preventDefault(),a.stopPropagation();var t=0;if($.each($(_+" #J_dataModal_list tr"),function(){if("1"==$(this).attr("edit"))return!(t=1)}),1==t)return toastr.warning("请先保存未保存的数据"),!1;var e={},l=$(this).parent().parent();e.index=l.index(),e.tableId=l.attr("tableId"),e.chianeseName=l.attr("chianeseName"),e.englishName=l.attr("englishName"),e.folderId=l.attr("folderId"),e.dbTablespace=l.attr("dbTablespace"),e.dbUser=l.attr("dbUser"),e.dictId=l.attr("dictId"),e.remark=l.attr("remark"),e.addNew="0",d.treeDataEdit(e)}),$("body").on("click",_+" #J_dataModal_list .J_dataModel_cancel",function(a){a.preventDefault(),a.stopPropagation();var t=$(this).parent().parent();if(!t.attr("tableid")){var e=t.index();return $(_+" #J_dataModal_list tr:eq("+e+")").remove(),0==$(_+" #J_dataModal_list tr").length&&$(_+" #J_dataModal_list").html('<tr class="lastTr"><td colspan="9" class="t-c">暂无数据</td></tr>'),!1}var l=t.attr("tableId"),n=t.attr("chianeseName"),s=t.attr("englishName"),d=t.attr("folderName"),r=t.attr("dbTablespace"),i=t.attr("dbUser"),o=t.attr("dictName"),c=t.attr("remark"),m='\n                <td class="t-c"> '+l+" </td>\n                <td> "+n+" </td>\n                <td> "+s+' </td>\n                <td class="foldername"> '+d+" </td>\n                <td> "+r+" </td>\n                <td> "+i+' </td>\n                <td class="dictname"> '+o+' </td>\n                <td title="'+c+'"> <div>'+c+'</div> </td>\n                <td> \n                    <a class="J_dataModel_save hide">保存</a>\n                    <a class="J_dataModel_edit">编辑</a> \n                    <a class="J_dataModel_cancel hide">取消</a> \n                    <a class="J_dataModel_del hide">删除</a> \n                </td>\n            ';t.html(m),t.children("td").css("padding","8px"),t.attr("edit","0")}),$("body").on("click",_+" #J_dataModal_list .J_dataModel_del",function(){var a=$(this).parent().parent();if(tableId=a.attr("tableid"),!tableId){var t=a.index();return $(_+" #J_dataModal_list tr:eq("+t+")").remove(),0==$(_+" #J_dataModal_list tr").length&&$(_+" #J_dataModal_list").html('<tr class="lastTr"><td colspan="9" class="t-c">暂无数据</td></tr>'),!1}var e={};e.tableId=a.attr("tableid"),e.operType="DEL",bootbox.confirm("确定删除吗？",function(a){a&&(App.blockUI({boxed:!0,message:"删除中..."}),d.setModify(e))})}),$("body").on("click",_+" #J_dataModal_list tr",function(){if($(this).hasClass("lastTr"))return $(_+" #J_dataModal_type_list").html('<tr class="lastTr"><td colspan="10" class="t-c">暂无数据</td></tr>'),!1;$(_+" #J_dataModal_list tr").removeClass("active"),$(this).addClass("active");var a=$(this).attr("tableId"),t={};t.tableId=a,d.getMember(t)}),$("body").on("click",_+" #J_dataModelType_add",function(){if(1==$(_+" #J_dataModal_list tr").length&&$(_+" #J_dataModal_list tr").hasClass("lastTr"))return toastr.info("请先添加模型数据表"),!1;var a=0;if($.each($(_+" #J_dataModal_type_list tr"),function(){if("1"==$(this).attr("edit"))return!(a=1)}),1==a)return toastr.warning("请先保存未保存的数据"),!1;var t={};if($(_+" #J_dataModal_type_list tr:last-child").hasClass("lastTr"))t.tableId="",t.modelchianesename=$(_+" #J_dataModal_list tr.active").attr("chianesename"),t.chianeseName="",t.englishName="",t.columnTypeVal="C",t.columnLength="",t.isPrimary=0,t.isNull=1,t.isForeign=0,t.remark="";else{var e=$(_+" #J_dataModal_type_list tr:last-child");t.modelchianesename=e.attr("modelchianesename"),t.chianeseName=e.attr("chianeseName"),t.englishName=e.attr("englishName"),t.columnTypeVal=e.attr("columntypekey"),t.columnLength=e.attr("columnLength"),t.isPrimary=e.attr("isPrimary"),t.isNull=e.attr("isNull"),t.isForeign=e.attr("isForeign"),t.remark=e.attr("remark")}var l="";for(var n in d.fieldType)l+='<option value="'+n+'">'+d.fieldType[n]+"</option>";var s='\n                <tr edit="1" addNew="1">\n                    <td class="modelchianesename"> <input class="form-control input-small" value="'+t.modelchianesename+'"  readonly="readonly"> </td>\n                    <td class="chianeseName"> <input class="form-control input-small" value="'+t.chianeseName+'"> </td>\n                    <td class="englishName"> <input class="form-control input-small" value="'+t.englishName+'"> </td>\n                    <td class="columnTypeVal"> \n                        <select class="form-control input-msmall">\n                            '+l+'\n                        </select>\n                    </td>\n                    <td class="columnLength"> <input class="form-control input-msmall" maxlength="6" value="'+t.columnLength+'"> </td>\n                    <td class="isPrimary">\n                        <select class="form-control input-xsmall">\n                            <option value="0">否</option>\n                            <option value="1">是</option>\n                        </select>\n                    </td>\n                    <td class="isNull">\n                        <select class="form-control input-xsmall">\n                            <option value="0">否</option>\n                            <option value="1">是</option>\n                        </select>\n                    </td>\n                    <td class="isForeign">\n                        <select class="form-control input-xsmall">\n                            <option value="0">否</option>\n                            <option value="1">是</option>\n                        </select>\n                    </td>\n                    <td class="remark"> <input class="form-control input-small" value="'+t.remark+'"> </td>\n                    <td> \n                        <a class="J_member_save">保存</a>\n                        <a class="J_member_edit hide">编辑</a> \n                        <a class="J_member_cancel">取消</a> \n                        <a class="J_member_del">删除</a> \n                    </td>\n                </tr>\n            ';"1"==$(_+" #J_dataModal_type_list tr").length&&$(_+" #J_dataModal_type_list tr").hasClass("lastTr")?$(_+" #J_dataModal_type_list").html(s):$(_+" #J_dataModal_type_list").append(s),$(_+" #J_dataModal_type_list .columnTypeVal select").val(t.columnTypeVal),$(_+" #J_dataModal_type_list .isPrimary select").val(t.isPrimary),$(_+" #J_dataModal_type_list .isNull select").val(t.isNull),$(_+" #J_dataModal_type_list .isForeign select").val(t.isForeign)}),$("body").on("click",_+" #J_dataModal_type_list .J_member_save",function(){var a={isDel:0};return a.tr=$(this).parent().parent(),a.columnId=a.tr.attr("columnId"),a.addNew=a.tr.attr("addNew"),a.tableId=$(_+" #J_dataModal_type_list .tableId input").val(),a.chianeseName=$(_+" #J_dataModal_type_list .chianeseName input").val(),a.englishName=$(_+" #J_dataModal_type_list .englishName input").val(),a.columnType=$(_+" #J_dataModal_type_list .columnTypeVal select").val(),a.columnLength=$(_+" #J_dataModal_type_list .columnLength input").val(),a.isPrimary=$(_+" #J_dataModal_type_list .isPrimary select").val(),a.isNull=$(_+" #J_dataModal_type_list .isNull select").val(),a.isForeign=$(_+" #J_dataModal_type_list .isForeign select").val(),a.remark=$(_+" #J_dataModal_type_list .remark input").val(),a.chianeseName?a.englishName?(a.tableId=$(_+" #J_dataModal_list tr.active").attr("tableid"),"1"==a.addNew?a.operType="ADD":a.operType="UPD",void d.setMember(a)):(toastr.error("字段英文名称不能为空"),!1):(toastr.error("字段中文名称不能为空"),!1)}),$("body").on("click",_+" #J_dataModal_type_list .J_dataModel_edit",function(){var a=0;if($.each($(_+" #J_dataModal_type_list tr"),function(){if("1"==$(this).attr("edit"))return!(a=1)}),1==a)return toastr.warning("请先保存未保存的数据"),!1;var t=$(this).parent().parent();t.attr("edit",1);var e={};e.tableId=t.attr("tableId"),e.modelchianesename=t.attr("modelchianesename"),e.chianeseName=t.attr("chianeseName"),e.englishName=t.attr("englishName"),e.columnType=t.attr("columnTypeKey"),e.columnLength=t.attr("columnLength"),e.isPrimary=t.attr("isPrimary"),e.isNull=t.attr("isNull"),e.isForeign=t.attr("isForeign"),e.remark=t.attr("remark");var l="";for(var n in d.fieldType)l+='<option value="'+n+'">'+d.fieldType[n]+"</option>";var s='\n                <td class="modelchianesename"> <input class="form-control input-small" value="'+e.modelchianesename+'" readonly="readonly"> </td>\n                <td class="chianeseName"> <input class="form-control input-small" value="'+e.chianeseName+'"> </td>\n                <td class="englishName"> <input class="form-control input-small" value="'+e.englishName+'"> </td>\n                <td class="columnTypeVal"> \n                    <select class="form-control input-msmall">\n                        '+l+'\n                    </select>\n                </td>\n                <td class="columnLength"> <input class="form-control input-msmall" maxlength="6" value="'+e.columnLength+'"> </td>\n                <td class="isPrimary">\n                    <select class="form-control input-xsmall">\n                        <option value="0">否</option>\n                        <option value="1">是</option>\n                    </select>\n                </td>\n                <td class="isNull">\n                    <select class="form-control input-xsmall">\n                        <option value="0">否</option>\n                        <option value="1">是</option>\n                    </select>\n                </td>\n                <td class="isForeign">\n                    <select class="form-control input-xsmall">\n                        <option value="0">否</option>\n                        <option value="1">是</option>\n                    </select>\n                </td>\n                <td class="remark"> <input class="form-control input-small" value="'+e.remark+'"> </td>\n                <td> \n                    <a class="J_member_save">保存</a>\n                    <a class="J_member_edit hide">编辑</a> \n                    <a class="J_member_cancel">取消</a> \n                    <a class="J_member_del">删除</a> \n                </td>';t.html(s),t.children(".columnTypeVal").children("select").val(e.columnType),t.children(".isPrimary").children("select").val(e.isPrimary),t.children(".isNull").children("select").val(e.isNull),t.children(".isForeign").children("select").val(e.isForeign)}),$("body").on("click",_+" #J_dataModal_type_list .J_member_cancel",function(){var a=$(this).parent().parent();if(!a.attr("tableid")){var t=a.index();return $(_+" #J_dataModal_type_list tr:eq("+t+")").remove(),0==$(_+" #J_dataModal_type_list tr").length&&$(_+" #J_dataModal_type_list").html('<tr class="lastTr"><td colspan="10" class="t-c">暂无数据</td></tr>'),!1}a.attr("edit","0");var e={};e.tableId=a.attr("tableId"),e.chianeseName=a.attr("chianeseName"),e.englishName=a.attr("englishName"),e.dictName=a.attr("columnTypeVal"),e.columnLength=a.attr("columnLength"),e.isPrimary=a.attr("isPrimary"),e.isNull=a.attr("isNull"),e.isForeign=a.attr("isForeign"),e.remark=a.attr("remark");var l='\n                <td class="t-c" class="tableId"> '+e.tableId+' </td>\n                <td class="chianeseName"> '+e.chianeseName+' </td>\n                <td class="englishName"> '+e.englishName+' </td>\n                <td class="columnTypeVal"> '+e.dictName+' </td>\n                <td class="columnLength"> '+e.columnLength+' </td>\n                <td class="isPrimary">\n                    '+("1"==e.isPrimary?"是":"否")+'\n                </td>\n                <td class="isNull">\n                    '+("1"==e.isNull?"是":"否")+'\n                </td>\n                <td class="isForeign"> \n                    '+("1"==e.isForeign?"是":"否")+'\n                </td>\n                <td title="'+e.remark+'" class="remark"> <div>'+e.remark+'</div> </td>\n                <td> \n                    <a class="J_dataModel_edit">编辑</a> \n                </td>\n            ';a.html(l)}),$("body").on("click",_+" #J_dataModal_type_list .J_member_del",function(){var a=$(this).parent().parent();if(tableId=a.attr("tableid"),!tableId){var t=a.index();return $(_+" #J_dataModal_type_list tr:eq("+t+")").remove(),0==$(_+" #J_dataModal_type_list tr").length&&$(_+" #J_dataModal_type_list").html('<tr class="lastTr"><td colspan="10" class="t-c">暂无数据</td></tr>'),!1}var e={};e.columnId=a.attr("columnId"),e.operType="DEL",bootbox.confirm("确定删除吗？",function(a){a&&(App.blockUI({boxed:!0,message:"删除中..."}),d.setMember(e))})}),$("body").on("click",_+" #J_dataModel_export",function(){var a={},t=$("#J_dataModel_tree li[aria-selected=true]").attr("folderId");a.folderId=t,a.expType="model",App.blockUI({boxed:!0,message:"导出中..."}),d.export(a).then(function(a){return d.listImport2({fileClass:"ZIP",filePath:a.bcjson.items[0].filePatch}).then(function(a){return d.listImport3({fileClass:"ZIP",downloadToken:a.bcjson.items[0].downloadToken,_s_t_i_0000:$.kingdom.getValue("x-trace-user-id")})})})}),$("body").on("click",_+" #J_dataModelType_export",function(){var a={},t=$(_+" #J_dataModal_list tr.active").attr("tableId");if(!(a.tableId=t))return toastr.info("请先新增模型数据表"),!1;a.expType="member",App.blockUI({boxed:!0,message:"导出中..."}),d.export(a).then(function(a){return d.listImport2({fileClass:"ZIP",filePath:a.bcjson.items[0].filePatch}).then(function(a){return d.listImport3({fileClass:"ZIP",downloadToken:a.bcjson.items[0].downloadToken,_s_t_i_0000:$.kingdom.getValue("x-trace-user-id")})})})}),$("body").on("click",_+" .add_table",function(){var a={},t=$(_+" #J_dataModal_list tr.active").attr("tableId");if(!(a.tableId=t))return toastr.info("请先新增模型数据表"),!1;d.addTable(a)}),$("body").on("click",_+" .data-query",function(){var a={},t=$(_+" #J_dataModal_list tr.active").attr("tableId");if(!(a.tableId=t))return toastr.info("请先新增模型数据表"),!1;d.dataQuery(a)}),$("body").on("click",_+" #add_table .J_table_default",function(){var a=$(_+" #J_dataModal_list tr.active").attr("tableId"),t={};t.tableId=a,d.tabledel(t)}),$("body").on("click",_+" #data-query .down",function(){var a={expType:"down"};a.tableId=$(_+" #J_dataModal_list tr.active").attr("tableId"),App.blockUI({boxed:!0,message:"导出中..."}),d.export(a).then(function(a){return d.listImport2({fileClass:"ZIP",filePath:a.bcjson.items[0].filePatch}).then(function(a){return d.listImport3({fileClass:"ZIP",downloadToken:a.bcjson.items[0].downloadToken,_s_t_i_0000:$.kingdom.getValue("x-trace-user-id")})})})})}),module.exports=a});