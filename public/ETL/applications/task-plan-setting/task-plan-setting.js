define(function(require,exports,module){var p=require("./task-plan-settingShow");require("plugins/jquery-validation/js/jquery.validate"),require("plugins/jstree/dist/jstree"),require("plugins/jstree/dist/themes/default/style.css"),require("plugins/jquery-validation/js/additional-methods.js");var t={load:function(){p._load()}};$(function(){function n(t){var e=$("#"+t+" .line .radio span"),a=0;return $.each(e,function(t,e){"checked"===$(e).attr("class")&&(a=t)}),a}function c(t){var a="",e=$("#"+t+" .checkbox-div");return $.each(e,function(t,e){"checked"===$(e).find("span").attr("class")&&(a=a+","+t)}),""===a?($("#"+t+" .checkbox-div:eq(0) input").click(),"0"):a.substring(1,a.length)}function r(){var a="";$.each($("#crons_set_table input"),function(t,e){t<7&&(a=0===t?$(e).val().toString():a+" "+$(e).val().toString())}),$("#tps-cron-input").val(a)}$("body").on("click","#J_tps_search_form button[type=submit]",function(){if(!App.checkDate($("#J_tps_search_form"),"上次执行时间"))return!1;var t=App.getFormParams("J_tps_search_form");t.pageNumber="1",p.getTaskSetList(t)}),$("body").on("change","#J_task_plan_options",function(){$(this).next().attr("name",$(this).val())}),$("body").on("click","#J_add_plan_btn",function(){App.clearForm("J_form_basc"),$("#J_form_basc input[name='scheduleLaw']")[0].click(),$("#J_add_plan_modal").modal("show"),$("#J_add_plan_modal .modal-header h4").text("新增调度计划"),$(".J_form_basc_submit").attr("id","J_form_basc_submit_add"),$("#task-plan-setting #J_plan_setting_time").css("display","none")}),$("body").on("click","#J_edit_plan_btn",function(){$("#task-plan-setting #J_plan_setting_time").css("display","block"),App.clearForm("J_form_basc");var t=$("#taskSetList .checker input:checked ").data("obj"),e=$("#taskSetList .checker input:checked ").length;e?1<e?toastr.info("请选择一条进行编辑！"):($("#J_add_plan_modal .modal-header h4").text("修改调度计划"),$(".J_form_basc_submit").attr("id","J_form_basc_submit_edit"),App.setFormData("J_form_basc",t),t.executeTime&&$("#J_form_basc [name=executeTime]").val($.kingdom.toDateTime(t.executeTime)),t.validStartDate&&$("#J_form_basc [name=validStartDate]").val($.kingdom.toDateTime(t.validStartDate)),t.validEndDate&&$("#J_form_basc [name=validEndDate]").val($.kingdom.toDateTime(t.validEndDate)),"20991231235959"===t.validEndDate&&($("#J_form_basc [fakename=forever]").click(),$("[name=validStartDate], [name=validEndDate]").val("")),$("#J_plan_setting_time .prev_time").html($.kingdom.toDateTime(t.beforeTime)),t.nextTime?$("#J_plan_setting_time .next_time").html($.kingdom.toDateTime(t.nextTime)):$("#J_plan_setting_time .next_time").html("0000-00-00 00:00:00"),$("#J_add_plan_modal").modal("show")):toastr.info("请先勾选！")}),$("body").on("click","#J_delete_btn",function(){var t=$("#task_set_table .checked"),a=[];$.each(t,function(t,e){$(e).closest("tr").data("scheduleid")&&a.push($(e).closest("tr").data("scheduleid"))});var e={};e.scheduleId=a.join(","),0===a.length?toastr.info("请先勾选！"):bootbox.confirm("确定删除吗？",function(t){t&&(App.blockUI({boxed:!0,message:"删除中..."}),p.deletePlanSet(e))})}),$("body").on("click","#J_form_basc_submit_edit",function(){if($("#J_form_basc").valid()){var t=App.getFormParams("J_form_basc");if(t.executeTime=t.executeTime.replace(/[\s-:]/g,""),t.validStartDate=t.validStartDate.replace(/[\s-:]/g,""),t.validEndDate=t.validEndDate.replace(/[\s-:]/g,""),1===$("#J_form_basc [fakename=forever]:checked").length&&(t.validStartDate=$.kingdom.timeFormat((new Date).getTime()).replace(/[-: ]/g,""),t.validEndDate="20991231235959"),parseInt(t.validStartDate)>parseInt(t.validEndDate))return void toastr.info("计划有效时间开始时间不能大于结束时间");$("#uniform-inlineCheckbox2 span").hasClass("checked")?t.startFlag="2":t.starFlat="3",$("#uniform-repeatFlag span").hasClass("checked")?t.repeatFlag="Y":t.repeatFlag="N",App.blockUI({boxed:!0,message:"处理中..."}),p.editPlanSet(t)}else toastr.info("请检查所有字段是否填写正确")}),$("body").on("click","#J_form_basc_submit_add",function(){if($("#J_form_basc").valid()){var t=App.getFormParams("J_form_basc");t.executeTime=t.executeTime.replace(/[\s-:]/g,"");var e=t.cronExpression.replace(/ /g,""),a=t.scheduleInterval.replace(/ /g,""),n=t.frequency.replace(/ /g,"");if(!(e||a&&n))return toastr.info("请输入执行频率或CORN表达式"),!1;if(t.validStartDate=t.validStartDate.replace(/[\s-:]/g,""),t.validEndDate=t.validEndDate.replace(/[\s-:]/g,""),1===$("#J_form_basc [fakename=forever]:checked").length){var i=new Date,o=i.getFullYear(),s=i.getMonth()+1,l=i.getDate(),c=i.getHours(),r=i.getMinutes(),_=i.getSeconds();t.validStartDate=$.kingdom.timeFormat(new Date(o-1+"-"+s+"-"+l+" "+c+":"+r+":"+_).getTime()).replace(/[-: ]/g,""),t.validEndDate="20991231235959"}if(parseInt(t.validStartDate)>parseInt(t.validEndDate))return void toastr.info("计划有效时间开始时间不能大于结束时间");t.startFlag="2",App.blockUI({boxed:!0,message:"处理中..."}),p.addPlanSet(t)}else toastr.info("请检查所有字段是否填写正确")}),$("body").on("click","#J_cron_btn",function(){$("#J_crons_modal").modal("show")}),$("body").on("click","#tab_s .line input[type='radio'],#tab_m .line input[type='radio'],#tab_h .line input[type='radio'],#tab_d .line input[type='radio'],#tab_w .line input[type='radio'],#tab_o .line input[type='radio'],#tab_y .line input[type='radio']",function(){var t,e=$(this).closest(".tab-pane").attr("id"),a={tab_s:0,tab_m:1,tab_h:2,tab_d:3,tab_o:4,tab_w:5,tab_y:6}[e],n=$("#"+e+" .line input[type='radio']").index(this);if(0===n&&a<6)$("#crons_set_table input:eq("+a+")").val("*");else if(1===n&&a<5)t=$("#"+e+" .line:eq(1) input:eq(1)").val()+"-"+$("#"+e+" .line:eq(1) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t);else if(2===n&&a<5){var i=$("#"+e+" .line:eq(2) input:eq(1)").val()+"/"+$("#"+e+" .line:eq(2) input:eq(2)").val();$("#crons_set_table input:eq("+a+")").val(i)}else if(3===n&&a<3){var o=c(e);$("#crons_set_table input:eq("+a+")").val(o)}else if(3===n&&3===a){var s=$("#"+e+" .line:eq(3) input:eq(1)").val()+"W";$("#crons_set_table input:eq("+a+")").val(s)}else if(4===n&&3===a)$("#crons_set_table input:eq("+a+")").val("L");else if(5===n&&3===a)$("#crons_set_table input:eq("+a+")").val("?");else if(6===n&&3===a||5===n&&5===a||4===n&&4===a){var l=c(e);$("#crons_set_table input:eq("+a+")").val(l)}else 1===n&&5===a?(t=$("#"+e+" .line:eq(1) input:eq(1)").val()+"/"+$("#"+e+" .line:eq(1) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t)):2===n&&5===a?(t=$("#"+e+" .line:eq(2) input:eq(1)").val()+"#"+$("#"+e+" .line:eq(2) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t)):3===n&&5===a?(t=$("#"+e+" .line:eq(3) input:eq(1)").val()+"L",$("#crons_set_table input:eq("+a+")").val(t)):4===n&&5===a?$("#crons_set_table input:eq("+a+")").val("?"):3===n&&4===a?$("#crons_set_table input:eq("+a+")").val("?"):0===n&&6===a?$("#crons_set_table input:eq("+a+")").val(""):1===n&&6===a?$("#crons_set_table input:eq("+a+")").val("*"):2===n&&6===a&&(t=$("#"+e+" .line:eq(2) input:eq(1)").val()+"-"+$("#"+e+" .line:eq(2) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t));r()}),$("body").on("click","#tab_s .line:eq(1) .bootstrap-touchspin-down,#tab_s .line:eq(1) .bootstrap-touchspin-up,#tab_m .line:eq(1) .bootstrap-touchspin-down,#tab_m .line:eq(1) .bootstrap-touchspin-up,#tab_h .line:eq(1) .bootstrap-touchspin-down,#tab_h .line:eq(1) .bootstrap-touchspin-up,#tab_d .line:eq(1) .bootstrap-touchspin-down,#tab_d .line:eq(1) .bootstrap-touchspin-up,#tab_o .line:eq(1) .bootstrap-touchspin-down,#tab_o .line:eq(1) .bootstrap-touchspin-up,#tab_y .line:eq(2) .bootstrap-touchspin-down,#tab_y .line:eq(2) .bootstrap-touchspin-up",function(){var t,e=$(this).closest(".tab-pane").attr("id"),a={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_o:"4",tab_w:"5",tab_y:"6"}[e];1===n(e)?(t=$("#"+e+" .line:eq(1) input:eq(1)").val()+"-"+$("#"+e+" .line:eq(1) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t)):2===n(e)&&"6"===a&&(t=$("#"+e+" .line:eq(2) input:eq(1)").val()+"-"+$("#"+e+" .line:eq(2) input:eq(2)").val(),$("#crons_set_table input:eq("+a+")").val(t)),r()}),$("body").on("click","#tab_w .line:eq(1) .bootstrap-touchspin-down,#tab_w .line:eq(1) .bootstrap-touchspin-up",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_w:"5"}[t];if(1===n(t)){var a=$("#"+t+" .line:eq(1) input:eq(1)").val()+"/"+$("#"+t+" .line:eq(1) input:eq(2)").val();$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#tab_w .line:eq(2) .bootstrap-touchspin-down,#tab_w .line:eq(2) .bootstrap-touchspin-up",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_w:"5"}[t];if(2===n(t)){var a=$("#"+t+" .line:eq(2) input:eq(1)").val()+"#"+$("#"+t+" .line:eq(2) input:eq(2)").val();$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#tab_w .line:eq(3) .bootstrap-touchspin-down,#tab_w .line:eq(3) .bootstrap-touchspin-up",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_w:"5"}[t];if(3===n(t)){var a=$("#"+t+" .line:eq(3) input:eq(1)").val()+"L";$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#tab_s .line:eq(2) .bootstrap-touchspin-down,#tab_s .line:eq(2) .bootstrap-touchspin-up,#tab_m .line:eq(2) .bootstrap-touchspin-down,#tab_m .line:eq(2) .bootstrap-touchspin-up,#tab_h .line:eq(2) .bootstrap-touchspin-down,#tab_h .line:eq(2) .bootstrap-touchspin-up,#tab_d .line:eq(2) .bootstrap-touchspin-down,#tab_d .line:eq(2) .bootstrap-touchspin-up,#tab_o .line:eq(2) .bootstrap-touchspin-down,#tab_o .line:eq(2) .bootstrap-touchspin-up",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_o:"4",tab_w:"5"}[t];if(2===n(t)){var a=$("#"+t+" .line:eq(2) input:eq(1)").val()+"/"+$("#"+t+" .line:eq(2) input:eq(2)").val();$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#tab_s .checkbox-div input,#tab_m .checkbox-div input,#tab_h .checkbox-div input,#tab_d .checkbox-div input,#tab_w .checkbox-div input,#tab_o .checkbox-div input",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3",tab_o:"4",tab_w:"5"}[t];if(3===n(t)||6===n(t)&&"3"===e||5===n(t)&&"5"===e||4===n(t)&&"4"===e){var a=c(t);$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#tab_d .line:eq(3) .bootstrap-touchspin-down,#tab_d .line:eq(3) .bootstrap-touchspin-up",function(){var t=$(this).closest(".tab-pane").attr("id"),e={tab_s:"0",tab_m:"1",tab_h:"2",tab_d:"3"}[t];if(3===n(t)){var a=$("#"+t+" .line:eq(3) input:eq(1)").val()+"W";$("#crons_set_table input:eq("+e+")").val(a)}r()}),$("body").on("click","#task-plan-setting [type=treeselectchild] .jstree-anchor",function(){if(-1<$(this).closest("li").attr("class").indexOf("jstree-leaf")){var t=$(this).attr("id").match(/tbs-tree-(.*)_anchor/)[1];$(this).parents("[type=treeselectchild]").siblings("input[type=hidden]").val(t),$(this).parents("[type=treeselectchild]").siblings(".dropdown-toggle").val($(this).text()).attr("aria-expanded","false").parent().removeClass("open")}}),$("body").on("click",".J_form_corn_btn",function(){$("#J_crons_modal").modal("hide"),$("textarea[name='cronExpression']").val($("#tps-cron-input").val())}),$("body").on("keyup","#J_form_basc input[name='scheduleInterval']",function(){p.handleFrequency()}),$("body").on("change","#J_form_basc input[name='scheduleInterval'],#J_form_basc select[name='frequency']",function(){p.handleFrequency()})}),module.exports=t});