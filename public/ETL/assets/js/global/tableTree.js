var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};function TableTree(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.element=t,this.menus="",this.ths=e.checkbox?["<th>全选</th>"]:[],this.trs=[],this.isTheadRendered=!1,this.index=0;this.options=_extends({indentSize:20,openAll:!1,checkbox:!1,widthScale:1},e);var n=this.element.width();this.widthPercentage=(n-40)*this.options.widthScale/Object.keys(this.options.data[0].columns).length+"px",this.init(),this.bindEvent()}TableTree.prototype.init=function(){var t=this.generateTableTree("id","pId",this.options.data);this.element.html(t),App.initUniform()},TableTree.prototype.format=function(t){return"object"===(void 0===t?"undefined":_typeof(t))&&t?t.formatter():t},TableTree.prototype.formatTitle=function(t){return"object"===(void 0===t?"undefined":_typeof(t))?"":t},TableTree.prototype.renderTd=function(t,e,n){return this.isFirstTd?(this.isFirstTd=!1,'<td style="max-width: '+this.widthPercentage+'" class="ellipsis" title=\''+this.formatTitle(e[t])+'\'> \n\t                <span class="table-row-indent indent-level-0" style="padding-left: '+this.index*this.options.indentSize+'px;"></span>\n\t                <span class="table-row-expand-icon '+(n?"table-row-collapsed":"table-row-spaced")+'"></span>\n\t                '+this.format(e[t])+" \n\t            </td>"):'<td style="max-width: '+this.widthPercentage+'" class="ellipsis" title=\''+this.formatTitle(e[t])+"'> "+this.format(e[t])+" </td>"},TableTree.prototype.renderTdCheckbox=function(t){return this.options.checkbox?'<td class="width40">\n                        <input type="checkbox" '+t+" />\n                    </td>":""},TableTree.prototype.generateTableTree=function(t,e,n){var i=!0,o=!1,r=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var d=s.value;this.index++;var l="",h=d.hasOwnProperty("children")&&0<d.children.length;this.isFirstTd=!0;var c="";if(d.hasOwnProperty("attr")){var p=d.attr;for(var y in p)c+=y+"='"+p[y]+"' "}for(var f in d.columns)this.isTheadRendered||this.ths.push('<th class="t-l"> '+f+" </th>"),l+=this.renderTd(f,d.columns,h);this.isTheadRendered=!0,this.trs.push('<tr key="'+d[t].replace(/ /g,"")+'" pKey="'+d[e].replace(/ /g,"")+'" level="'+this.index+'" style="display: '+(1===this.index?"table-row":"none")+'">\n\t\t\t\t\t\t'+this.renderTdCheckbox(c)+"\n\t\t\t\t\t\t"+l+"\n\t\t\t\t\t</tr>"),h&&this.generateTableTree(t,e,d.children),this.index--}}catch(t){o=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}return"<thead>\n                <tr>\n                    "+this.ths.join(",")+"\n                </tr>\n            </thead>\n            <tbody>\n            \t"+this.trs.join(",")+"\n           \t<tbody>"},TableTree.prototype.openNode=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=$('[key="'+t+'"]'),i=$('[pkey="'+t+'"]'),o=this;i.show(),e&&n.find(".table-row-expand-icon").removeClass("table-row-collapsed").addClass("table-row-expanded"),$.each(i,function(){var t=0<$(this).find(".table-row-expanded").length,e=$(this).attr("key");t&&o.openNode(e,!1)})},TableTree.prototype.closeNode=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=$('[key="'+t+'"]'),i=$('[pkey="'+t+'"]'),o=this;i.hide(),e&&n.find(".table-row-expand-icon").removeClass("table-row-expanded").addClass("table-row-collapsed"),$.each(i,function(){var t=0<$(this).find(".table-row-expanded").length,e=$(this).attr("key");t&&o.closeNode(e,!1)})},TableTree.prototype.bindEvent=function(){var r=this;this.element.find(".table-row-expand-icon").click(function(){var t=$(this).hasClass("table-row-collapsed"),e=$(this).closest("tr").attr("key");t?r.openNode(e):r.closeNode(e)}),this.element.find("tbody tr input[type=checkbox]:not(.make-switch)").change(function(){var t=$(this).is(":checked"),e=$(this).closest("tr").attr("key"),n=$(this).closest("tr").attr("pkey");!function e(n,t){r.element.find("tbody tr[pkey='"+t+"']").each(function(){$(this).find("input[type=checkbox]:not(.make-switch)").prop("checked",n);var t=$(this).attr("key");e(n,t),n?$(this).addClass("active"):$(this).removeClass("active")})}(t,e),function t(e,n){if("-1"!==n){var i=e;e&&r.element.find("tbody tr[pkey='"+n+"']").each(function(){$(this).find("input[type=checkbox]:not(.make-switch)").prop("checked")||(i=!1)}),i?r.element.find("tbody tr[key='"+n+"']").addClass("active"):r.element.find("tbody tr[key='"+n+"']").removeClass("active"),r.element.find("tbody tr[key='"+n+"'] input[type=checkbox]:not(.make-switch)").prop("checked",i);var o=r.element.find("tbody tr[key='"+n+"']").attr("pkey");t(i,o)}}(t,n),t?$(this).closest("tr").addClass("active"):$(this).closest("tr").removeClass("active"),jQuery.uniform.update()})},$.fn.tableTree=function(t){return new TableTree(this,t)};