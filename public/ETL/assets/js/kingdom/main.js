var _extends=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};define(function(require,exports,module){window.App=require("app");var e=require("./kweb");require("js/kingdom/polyfill.min.js"),require("js/layouts/layout.min"),require("js/layouts/demo.min"),require("plugins/jquery-validation/js/jquery.validate"),require("plugins/jquery-validation/js/additional-methods.js"),require("plugins/jquery-validation/js/localization/messages_zh.min.js"),require("plugins/fullcalendar/fullcalendar"),require("plugins/fullcalendar/lib/moment.min"),require("plugins/fullcalendar/lang/zh-cn"),require("assets/plugins/colresizable/colResizable-1.6");var t=[],d=(e.kingdom.kconfig().theme,e.kingdom.kconfig().root);$.kingdom.kconfig().developer&&(console.log=function(){});function i(t,e){t=t||"index",history.pushState&&("common-page"==!t?history.pushState("","","index.html#"+t):"index"==t&&history.pushState("","","index.html")),$(".loading").remove(),$("#js_page_row,#index_page").hide(),$(".page-container").show();var i="",n="";if(-1<t.indexOf("common-page")&&!e){i="common-page";var a=t.substr(t.indexOf("?")+1,t.length);a=a.split("&");for(var o="{",l=0;l<a.length;l++){var s=a[l].split("=");"page"==s[0]?n=s[1]:o+='"'+s[0]+'":"'+s[1]+'",'}o=o.substr(0,o.length-1),o+="}",o=JSON.parse(o),$("#local-data").data("params",o)}else i=t.replace("#",""),n=e||i;var r=d+i+"/"+n;(new Date).getTime(),$.ajax({url:r+".html",dataType:"html",beforeSend:function(){App.blockUI({target:".page-content",overlayColor:"none",cenrerY:!0,animate:!0})},success:function(e){if(window.x_trace_page_id=$.kingdom.uuid(),null==e.match("<!DOCTYPE html>")){if(-1<t.indexOf("common-page"))$(".margin-top-20").fadeOut(),$("#js_page_common").html(e),$("#js_page_common").removeAttr("class").addClass("margin-top-20 page-"+i+" page-common-"+n),$("#js_page_common").fadeIn();else{if($("#js_page_common").hide(),$(".margin-top-20").hide(),$(".page-tabs-content a").removeClass("active"),0<$(".page-tabs-content a[data-titleId='"+i+"']").length)$(".page-tabs-content a[data-titleId='"+i+"']").addClass("active"),$("#"+i).show();else if("index"==t)$(".page-tabs-content a").eq(0).addClass("active"),$("#js_page_row").removeAttr("class").addClass("margin-top-20 page-"+i).html(e).show();else if(0===$(".page-tabs-content a[data-titleId='"+i+"']").length){var a=$("a[href=#"+t+"] span").html();"indexInformation"==t&&(a="信息统计"),$(".page-tabs-content").append('<a href="javascript:;" class="active J_menuTab" data-titleId="'+i+'">'+a+' <i class="fa fa-times-circle"></i></a>'),$(".page-content").append('<div id="'+i+'" class="margin-top-20 J_htmlTab page-'+i+'" style="display:none;"></div>'),$("#"+i).html(e).show()}g(),App.runResizeHandlers()}require.async(r+".js",function(e){e&&e.load&&(e.load(),p(".page-"+i),h(".page-"+i),$(".page-"+i+" .table").colResizable({liveDrag:!0,draggingClass:"dragging",resizeMode:"flex"}))}),c()}else toastr.info("请刷新当前页面重新登录。","登录失效！")},error:function(){var e='<div class="row"><div class="col-md-12 page-404"><div class="number font-red"> 404 </div><div class="details"><h3>啊唷，您要找的页面发生了意外。</h3><p>我们无法找到这个页面。<br/><p><a href="" class="btn red btn-outline"> 刷新试试 </a> 或<a href="index.html" class="btn red btn-outline"> 返回首页 </a><br> </p></div></div></div>';"common-page"==t?$("#js_page_common").removeAttr("class").addClass("margin-top-20 page-"+i).html(e).show():$("#js_page_row").removeAttr("class").addClass("margin-top-20 page-"+i).html(e).show()},complete:function(){App.unblockUI(".page-content")}})}function o(e){var a=$("li.nav-item"),t=($("li.nav-item a"),$("li.nav-item a[href=#"+e+"]"));(e||""==e)&&t&&t.length&&(a.removeClass("active open"),a.find(".arrow").removeClass("active open"),a.find(".selected").remove(),2==t.length?t.eq(1).parents(".nav-item").addClass("active open"):t.eq(0).parents(".nav-item").addClass("active open"),t.eq(0).parents(".nav-item").children(".nav-toggle").append("<span class='selected'></span>"),t.eq(0).parents(".nav-item").children(".nav-link").find(".arrow").addClass("open"))}var c=function(){$(".page-breadcrumb").empty(),$(".page-breadcrumb").append('<li><a href="index.html" style="color: #0C95E8;">主页</a></li>'),$(".active.open>a .title").each(function(e,a){t[e]=$(a).html(),$(".page-breadcrumb").append('<li><i class="fa fa-angle-right"></i><span></span></li>'),$(".page-breadcrumb li").eq(e+1).find("span").html($(a).html())})},g=function(){var e=navigator.userAgent.toLowerCase();if(-1<e.indexOf("ipad")||-1<e.indexOf("iphone")||-1<e.indexOf("android")||-1<e.indexOf("Android")||-1<e.indexOf("iPhone")){$("#head-navBtn").find("span").hide(),$("#head-navBtn").find("span").hide(),$(".tourist-wide a").each(function(){var e=$(this).find("i");$(this).html(e)})}else{var a;if(window.innerWidth?a=window.innerWidth:document.body&&document.body.clientWidth&&(a=document.body.clientWidth),a<800){$("#head-navBtn").find("span").hide();$(".tourist-wide a")}else $("#head-navBtn").find("span").show();$(window).resize(function(){$(this).width()<800?($("#head-navBtn").find("span").hide(),$("#head-navBtn").find("span").hide()):$("#head-navBtn").find("span").show()})}},p=function(e){if(0!==$(e+" .slide-toggle").length){$("body").width();var a=$(e+" .left-side").width(),t=($(".page-logo").outerWidth(),$(e+" .slide-toggle").position().left);$(e+" .right-content").css("width","calc(100% - "+(a+10)+"px)"),$(e+" .slide-toggle").click(function(){0<$(this).find(".fa-angle-left").length?($(this).siblings(".left-side").width(0),$(this).css({left:0}),$(this).siblings(".right-content").css("width","100%"),$(this).html('<i class="slide-icon fa fa-angle-right"></i>')):($(this).siblings(".left-side").width(a),$(this).css({left:t}),$(this).siblings(".right-content").css("width","calc(100% - "+(a+10)+"px)"),$(this).html('<i class="slide-icon fa fa-angle-left"></i>'))})}},h=function(e){if(0!==$(e+" .slide-toggle1").length){var a=$(e+" .left-side").width();$(e+" .right-content").css("width","calc(100% - "+(a+10)+"px)");var t=$(e+" .drag_bar").position().left;$(e).on("click",".slide-toggle1",function(){0<$(this).find(".fa-angle-left").length?($(".drag_bar").siblings(".left-side").width(0),$(".drag_bar").css({left:0}),$(".drag_bar").siblings(".right-content").css("width","100%"),$(this).html('<i class="slide-icon fa fa-angle-right"></i>'),$(this).css({left:0})):($(".drag_bar").siblings(".left-side").width(a),$(".drag_bar").css({left:t}),$(this).css("left",t-20),$(".drag_bar").siblings(".right-content").css("width","calc(100% - "+(a+10)+"px)"),$(this).html('<i class="slide-icon fa fa-angle-left"></i>'))})}};$(function(){var s,r,d,c,g,e,a=window.location.hash.substr(1).split("?")[0];function p(e,t){App.blockUI({boxed:!0,message:"加载调度计划中..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_schedule_calendar_info","v4.0",e,function(e){if("1"===e.bcjson.flag){var d=[],a=e.bcjson.items||[];0<a.length&&$.each(a,function(e,a){var t=a.scheduleInfo;if(0!==t.length){var i=0,n=[],o=0,l=[],s=0,r=[];$.each(t,function(e,a){"B"==a.executeFlag?(s++,r.push(a)):"F"==a.executeFlag?(o++,l.push(a)):"S"==a.executeFlag&&(i++,n.push(a))}),0!==i&&d.push({start:a.scheduleDate,end:a.scheduleDate,title:"成功完成("+i+")",currentAllData:n,className:"success-complete"}),0!==o&&d.push({start:a.scheduleDate,end:a.scheduleDate,title:"出错完成("+o+")",currentAllData:l,className:"error-complete"}),0!==s&&d.push({start:a.scheduleDate,end:a.scheduleDate,title:"出错中断("+s+")",currentAllData:r,className:"error-suspend"})}})}t?$("#modal-inside-calendar").fullCalendar("refetchEvents"):g(d),App.unblockUI()})}function n(){$("#J_variable_num").text($("#J_variable_modal .variable-r .list-group-item:not('.first')").length)}i(a),$("body").on("click","[data-toggle=collapse].collapse-control",function(){0<$(this).find(".fa-sort-desc").length?$(this).html('<i class="fa fa-sort-asc"></i><span>'+$.i18n.map.Collapse+"</span>"):$(this).html('<i class="fa fa-sort-desc"></i><span>'+$.i18n.map["Search-More"]+"</span>")}),$("body").on("click","[data-toggle=collapse] span, [data-toggle=collapse] i",function(e){e.stopPropagation(),$(this).parent().click()}),$("body").on("click","[data-toggle='link']",function(){var e=$(this).attr("href").split("#")[1];if($("#local-data").data("params",$(this).data("params")),$("#local-data").data("source",$(this).data("source")),"common-page"==e){var a=$(this).data("linkto");return i(e,a),!1}}),$("body").on("click",".js-backtolist",function(){if(-1<location.href.indexOf("?page"))window.close();else{$("#js_page_common").fadeOut();var e=location.hash;$(e).fadeIn(),$(this).is("[refresh]")&&i($(".J_menuTab.active").data("titleid"))}}),window.util={},window.util.highlightNav=o,toastr.options.closeButton=!0,toastr.options.setTimeout="500",toastr.options.positionClass="toast-top-center",bootbox.setDefaults({title:"Tips"}),$("#js-logout1").click(function(){$(this);bootbox.confirm("确定退出当前系统吗？",function(e){e&&$.kingdom.logout(function(e){App.blockUI({boxed:!0,message:"正在退出"}),1==e.bcjson.flag?window.setTimeout(function(){App.unblockUI(),window.location.href="/login.html"},1e3):(App.unblockUI(),toastr.success(e.bcjson.msg))})})}),$(window).bind("hashchange",function(){var e=window.location.hash.substr(1);if("#report-table-info-manage"!==location.hash){var a=location.href.replace(location.search,"");window.location.href=a}-1<e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),i(e),o(e)}),$("body").on("click",".nav-link",function(){var e=$(this).attr("href"),a=location.hash===e;if(-1<e.indexOf("#")&&a){var t=e.replace("#","");i(t),o(t)}}),$("body").on("change",".date-picker,.date-time-picker,select[data-select2-id]",function(){0<$(this).closest("form").length&&$(this).closest("form").validate().element(this)}),$("body").on("click",".sidebar-toggler",function(){var e=".page-"+location.hash.substring("1"),a=($(e+" .right-content").width(),$(e+" .left-side").width());0<$(e+" .slide-toggle .fa-angle-left").length?$(e+" .right-content").css("width","calc(100% - "+(a+9)+"px)"):$(e+" .right-content").css("width","calc(100% - "+a+"px)"),$(this).hasClass("close-flag")?($(".page-sidebar-menu.page-sidebar-menu-hover-submenu>li:last > .sub-menu").css({bottom:"0"}),$(this).removeClass("close-flag")):($(".page-sidebar-menu.page-sidebar-menu-hover-submenu>li:last > .sub-menu").css({bottom:"auto"}),$(this).addClass("close-flag"))}),$("body").on("mouseover","#header_notification_bar",function(){$(this).addClass("open")}),$("body").on("mouseout","#header_notification_bar",function(){$(this).removeClass("open")}),$("body").on("click","[type=jstree], [type=treeselectchild], .jstree-ocl, .jstree-closed",function(e){e.stopPropagation()}),$("body").on("click","[type=jstree] .jstree-anchor",function(e){e.stopPropagation(),$(this).parents("[type=jstree]").siblings("input[type=hidden]").val($(this).parent().attr("folderid")),$(this).parents("[type=jstree]").siblings(".dropdown-toggle").val($(this).text()).attr("aria-expanded","false").parent().removeClass("open")}),$("body").on("click",".dropdown-toggle[name='folderName'][data-toggle=dropdown]+i",function(e){e.stopPropagation(),$(this).parent().toggleClass("open")}),$("body").on("click",".dropdown-toggle[name='jobName'][data-toggle=dropdown]+i",function(e){e.stopPropagation(),$(this).parent().toggleClass("open")}),$("body").on("click","tbody tr .bootstrap-switch-label",function(e){e.stopPropagation()}),g=c=d=r=s="",e={header:{right:"prev,next today",left:"title"},defaultDate:(new Date).Format("yyyy-mm-dd"),monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],eventLimit:!1,eventStartEditable:!0,editable:!0,dayClick:function(e,a,t){console.log("Clicked on: "+e.format()),console.log("Coordinates: "+a.pageX+","+a.pageY),console.log("Current view: "+t.name)},eventClick:function(e){!function(a){$("#J_calendar_detail_modal").modal("show"),require.async("../../../applications/common-template/calendar-datail-list.handlebars",function(e){$("#J_calendar_detail_list_body").html(e(a.currentAllData))})}(e)},eventMouseover:function(){$(this).find(".fc-title").attr("title",$(this).find(".fc-title").html())},eventDrop:function(e,a,t,i,n,o,l,s){console.log(e+a+t+i+n+o+l+s)},events:function(e,a,t,i){var n=e._d.getFullYear().toString()+(e._d.getMonth()+1<10?"0"+(e._d.getMonth()+1):e._d.getMonth()+1)+(e._d.getDate()<10?"0"+e._d.getDate():e._d.getDate()),o=a._d.getFullYear().toString()+(a._d.getMonth()+1<10?"0"+(a._d.getMonth()+1):a._d.getMonth()+1)+(a._d.getDate()<10?"0"+a._d.getDate():a._d.getDate());d=n,c=o,g=i;var l={};l.startTime=n,l.endTime=o,l.scheduleId=s,l.executeFlag=r,p(l)}},$("#J_calendar_modal").on("show.bs.modal",function(){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_schedule_info","v4.0",{pageNumber:"1",pageSize:"999"},function(e){if("1"===e.bcjson.flag){var a=e.bcjson.items||[];if(0<a.length){var t="";$.each(a,function(e,a){t=t+"<div style='white-space:nowrap;padding: 8px 12px' scheduleId='"+a.scheduleId+"'>"+a.scheduleName+"</div>"}),$("#schedule-list-menu-calendar").html(t)}}}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_all_dict_data_list","v4.0",{},function(e){if("1"===e.bcjson.flag){var a=(e.bcjson.items||[])[0].EXECUTE_FLAG;if(a){var t="";$.each(a,function(e,a){"B"!==e&&"F"!==e&&"S"!=e||(t=t+"<div style='padding: 8px 12px' flagId='"+e+"'>"+a+"</div>")}),$("#flag-list-menu-calendar").html(t)}}}),$("#modal-inside-calendar").fullCalendar(e),setTimeout(function(){0===$("#J_calendar_modal .fc-view-container .fc-basic-view").length&&$("#J_calendar_modal .fc-today-button").click()},200)}),$("body").on("click","#J_calendar_modal_search_form button[type='submit']",function(){var t="";$.each($("#schedule-list-menu-calendar .title-color-blue"),function(e,a){t=t+$(a).attr("scheduleid")+","}),t=t||t.substring(0,t.length-1),s=t;var i="";$.each($("#flag-list-menu-calendar .title-color-blue"),function(e,a){i=i+$(a).attr("flagid")+","}),i=i&&i.substring(0,i.length-1),p({startTime:d,endTime:c,scheduleId:s,executeFlag:r=i},!0)}),$("body").on("click","#J_calendar_modal_search_form button[type='reset']",function(){$("#J_calendar_modal_search_form .dropdown-menu div").removeClass("title-color-blue")}),$("body").on("click","#schedule-list-menu-calendar div,#flag-list-menu-calendar div",function(e){e.stopPropagation(),$(this).toggleClass("title-color-blue");var t="",a=$(this).closest(".dropdown-menu").attr("id");$.each($("#"+a+" div"),function(e,a){"title-color-blue"===$(a).attr("class")&&(t=t+$(a).text()+",")}),$("#"+a).siblings("input").val(t)}),$("body").on("click","#J_variable_search",function(){t()}),$("body").on("click","#J_variable_modal .variable-r .list-group-item .v-close",function(){var e=$(this).closest(".list-group-item").data("variablename");$("input[type=checkbox][data-variablename="+e+"]").prop("checked",!1),jQuery.uniform.update(),$(this).closest(".list-group-item").remove(),n()}),$("body").on("click","#J_variable_modal .variable-r .list-group-item .v-delete",function(){$("#J_variable_modal .variable-r .list-group-item:not('.first')").remove(),n(),$("#J_variable_table tbody tr input[type=checkbox]").prop("checked",!1),jQuery.uniform.update()}),$("body").on("change","#J_variable_table tbody tr td input[type=checkbox]",function(){var e=$(this).prop("checked"),a=$(this).data("variablename"),t=$("#J_variable_modal .variable-r .list-group-item:not('.first')");if(e)if(0===t.length)$("#J_variable_modal .variable-r .list-group").append('<li class="list-group-item" data-variablename="'+a+'"> \n                        <span>'+a+'</span> \n                        <a class="v-close" title="删除"> <i class="fa fa-close"></i> </a> \n                    </li>');else{var i=!1;$.each(t,function(){var e=$(this).data("variablename");a===e&&(i=!0)}),i||$("#J_variable_modal .variable-r .list-group").append('<li class="list-group-item" data-variablename="'+a+'"> \n                            <span>'+a+'</span> \n                            <a class="v-close" title="删除"> <i class="fa fa-close"></i> </a> \n                        </li>')}else $.each(t,function(){var e=$(this).data("variablename");a===e&&$(this).remove()});n()}),$("body").on("click",".set-variable",function(){$("#J_variable_modal .variable-r .list-group-item:not('.first')").remove();var e=$(this).prev(".form-control");e.val().match(/\$\{[\w+$]+\}/g);e.attr("modalTrigger","modalTrigger"),n(),t(),$("#J_variable_modal").modal("show")}),$("body").on("click","#J_choose_variable",function(){var e=$("#J_variable_modal .variable-r .list-group-item:not('.first')");0!==e.length?($.each(e,function(){var e=$(this).data("variablename"),a=$("[modalTrigger=modalTrigger]").val();$("[modalTrigger=modalTrigger]").val(a+"${"+e+"}")}),$("#J_variable_modal").modal("hide")):toastr.info("请选择变量")}),$("#J_variable_modal").on("hide.bs.modal",function(){$("[modalTrigger=modalTrigger]").removeAttr("modalTrigger")});var t=function e(a){var t={taskType:"TV"};t=_extends(t,a),$.kingdom.getList({apiName:"bayconnect.superlop.get_task_detail_info",apiVision:"v4.0",params:t,tableId:"J_variable_table",pageId:"J_variable_page",template:"common-template/variable-list.handlebars",formName:"J_variable_form",isGoPage:!1,cb:e},function(){var e=$("#J_variable_modal .variable-r .list-group-item:not('.first')");$.each(e,function(){var e=$(this).data("variablename");$("input[type=checkbox][data-variablename="+e+"]").prop("checked",!0)}),jQuery.uniform.update()})}})});