(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"6QOq":function(a,e,t){"use strict";var n=t("g09b");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(t("p0pE")),c=n(t("gWZ8")),u=n(t("Y/ft"));t("miYZ");var l=n(t("tsqr")),o=n(t("d6i3")),s=n(t("usdK")),i=n(t("ywRk")),d=i.default.getDataSourceList,f=i.default.getTableData,p=i.default.getMetadataTablePerform,b=i.default.getColumn,m=i.default.operateDataSet,y=i.default.getDataSetDetail,g=i.default.getVariableList,x={namespace:"sqlDataSource",state:{sqlDataSetName:"",activeKey:"",totalCount:0,metaDataTableList:[],dataSourceList:[],connectionId:"",tableData:[],column:[],defaultPageSize:5,columnData:[],dataSet:{},variableList:[]},effects:{getVariableList:o.default.mark(function a(e,t){var n,r,c,u,l;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=e.callback,c=t.call,u=t.put,a.next=4,c(g,{param:n});case 4:if(l=a.sent,!l||"1"!==l.bcjson.flag){a.next=9;break}return a.next=8,u({type:"setVariableList",payload:l.bcjson.items});case 8:r&&r(l.bcjson.items);case 9:case"end":return a.stop()}},a)}),getDataSetDetail:o.default.mark(function a(e,t){var n,r,c,u,l;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=e.callback,c=t.call,u=t.put,a.next=4,c(y,{param:n});case 4:if(l=a.sent,!l||"1"!==l.bcjson.flag){a.next=9;break}return a.next=8,u({type:"saveDataSet",payload:l.bcjson.items[0]});case 8:r&&r(l.bcjson.items[0]);case 9:case"end":return a.stop()}},a)}),addDataSet:o.default.mark(function a(e,t){var n,r,c;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=t.call,a.next=4,r(m,{param:n});case 4:c=a.sent,c&&"1"===c.bcjson.flag&&(l.default.success(c.bcjson.msg),s.default.goBack());case 6:case"end":return a.stop()}},a)}),getDataSourceList:o.default.mark(function a(e,t){var n,r,c,s,i,f;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=t.call,c=t.put,s=n.connectionId,i=(0,u.default)(n,["connectionId"]),a.next=5,r(d,{param:i});case 5:if(f=a.sent,!f||"1"!==f.bcjson.flag){a.next=18;break}return a.next=9,c({type:"setDataSourceList",payload:f.bcjson.items});case 9:if(s){a.next=12;break}return a.next=12,c({type:"saveConnectionId",payload:{connectionId:s}});case 12:return a.next=14,c({type:"clear",payload:[]});case 14:return a.next=16,c({type:"getMetadataList",payload:{connection_id:s||f.bcjson.items[0]&&f.bcjson.items[0].connectionId,pageNumber:"1",pageSize:"30"}});case 16:a.next=19;break;case 18:l.default.error(f.bcjson.msg.substring(0,1e3));case 19:case"end":return a.stop()}},a)}),getMetadataList:o.default.mark(function a(e,t){var n,r,u,s,i,d;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=t.call,u=t.put,s=t.select,a.next=4,s(function(a){var e=a.sqlDataSource;return e.metaDataTableList});case 4:return i=a.sent,a.next=7,r(f,{param:n});case 7:if(d=a.sent,!d||"1"!==d.bcjson.flag){a.next=13;break}return a.next=11,u({type:"setDataTableList",payload:{list:[].concat((0,c.default)(i),(0,c.default)(d.bcjson.items.map(function(a){return{id:a.tableId,name:"".concat(a.schemName,".").concat(a.tableName),icon:"iconbianjiqi_charubiaoge",otherInfo:a}}))),totalCount:d.bcjson.totalCount}});case 11:a.next=14;break;case 13:l.default.error(d.bcjson.msg.substring(0,1e3));case 14:case"end":return a.stop()}},a)}),getColumn:o.default.mark(function a(e,t){var n,r,c,u;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=t.call,c=t.put,a.next=4,r(b,{param:n});case 4:if(u=a.sent,!u||"1"!==u.bcjson.flag){a.next=8;break}return a.next=8,c({type:"changeColumnData",payload:u.bcjson.items});case 8:case"end":return a.stop()}},a)}),getMetadataTablePerform:o.default.mark(function a(e,t){var n,r,c,u,l,s;return o.default.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return n=e.payload,r=t.call,c=t.put,a.next=4,r(p,{param:n});case 4:if(u=a.sent,!u||"1"!==u.bcjson.flag){a.next=14;break}return l=u.bcjson.items[0]?u.bcjson.items[0]:{},s=Object.keys(l).map(function(a){return{value:a,type:isNaN(l[a])?"dimension":"measure",width:150}}),a.next=10,c({type:"changeColumn",payload:s});case 10:return a.next=12,c({type:"addMetadataTablePerform",payload:u.bcjson.items});case 12:a.next=16;break;case 14:return a.next=16,c({type:"addMetadataTablePerform",payload:[]});case 16:case"end":return a.stop()}},a)})},reducers:{setVariableList:function(a,e){return(0,r.default)({},a,{variableList:e.payload})},changeActive:function(a,e){return(0,r.default)({},a,{activeKey:e.payload})},clear:function(a){return(0,r.default)({},a,{metaDataTableList:[]})},setDataTableList:function(a,e){var t=e.payload,n=t.list,c=t.totalCount;return(0,r.default)({},a,{metaDataTableList:n,totalCount:c})},setDataSourceList:function(a,e){return(0,r.default)({},a,{dataSourceList:e.payload})},saveConnectionId:function(a,e){return(0,r.default)({},a,{connectionId:e.payload.connectionId})},changeColumn:function(a,e){return(0,r.default)({},a,{column:e.payload})},addMetadataTablePerform:function(a,e){return(0,r.default)({},a,{tableData:e.payload})},clearMetadata:function(a){return(0,r.default)({},a,{tableData:[],column:[]})},changeDataSetName:function(a,e){return(0,r.default)({},a,{sqlDataSetName:e.payload})},changeDefaultPageSize:function(a,e){var t=e.payload;return(0,r.default)({},a,{defaultPageSize:t})},changeColumnData:function(a,e){return(0,r.default)({},a,{columnData:e.payload})},saveDataSet:function(a,e){return(0,r.default)({},a,{dataSet:e.payload})},clearAll:function(){return{sqlDataSetName:"",activeKey:"",totalCount:0,metaDataTableList:[],dataSourceList:[],connectionId:"",tableData:[],column:[],defaultPageSize:5,columnData:[],dataSet:{},variableList:[]}}}};e.default=x}}]);