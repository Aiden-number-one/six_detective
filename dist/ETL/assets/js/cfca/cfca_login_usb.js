var CryptoAgent="",CryptoClient="";function check_CFCA_cer(){SelectCertificateOnClick_usb()}function SelectCertificateOnClick_usb(){var e={username:$("#username").val()},t=kifpaction+"/cfca!checkUserCert.do?ajax=yes";$.post(t,e,function(e){if("1"!=e.result)return $.kd.closeLoading(),void $.kd.kdAlert(e.message,function(){$("#valid_code").val(""),$("#password").val("").focus(),$("#codeimg").click(),$("input").attr("readonly",!1).removeClass("kdValidform_readonly"),$("#tellersubmit").attr("disabled",!1)});serialNo=e.message,1==check_cert_usb(serialNo)&&SignMessageOnClick_usb()},"json")}function check_cert_usb(e){try{var t=e;CryptoClient.SelectCertificate("","",t);return!0}catch(e){return confirm("您的usb接口没有对应的证书，请先和管理员申请证书!")&&(window.location.href="/index.html?action=await&_="+(new Date).getTime()),!1}}function SignMessageOnClick_usb(){var e=$("#username").val(),t={custId:e,password:$("#password").val(),serverid:"1",exchangeid:"1",openid:"null"};t=JSON.stringify(t);var n="";try{if(n=CryptoClient.SignMsgPKCS7(t,"SHA-1",!1),alert(n),!n){var r;return r=CryptoClient.GetLastErrorDesc(),void alert(r)}}catch(e){return alert(e),void alert("请安装证书")}var i=kifpaction+"/cfca!checkSignCert.do?ajax=yes",a={signature:n,username:e,cfca_certcode10011:"10011",sourcedata:t};$.post(i,a,function(e){1==e.result?window.location.href="/index.html?action=await&_="+(new Date).getTime():($.kd.closeLoading(),$.kd.kdAlert(e.message,function(){$("#valid_code").val(""),$("#password").val("").focus(),$("#codeimg").click(),$("input").attr("readonly",!1).removeClass("kdValidform_readonly"),$("#tellersubmit").attr("disabled",!1)}))},"json")}function PKCS10Requisition_SingleCert(e){var t=e;if(alert("csp_Name:"+t),CryptoAgent.CFCA_SetCSPInfo(2048,t)){if(CryptoAgent.CFCA_SetKeyAlgorithm("RSA")){var n=CryptoAgent.CFCA_PKCS10CertRequisition("CN=certRequisition,O=CFCA TEST CA,C=CN",1,0);if(n){alert("pkcs10Requisition:"+n),document.getElementById("textareaP10RSASingleCert").value=n;var r=CryptoAgent.CFCA_GetContainer();if(r)return document.getElementById("TextContianerName").value=r,n;i=CryptoAgent.GetLastErrorDesc();alert(i)}else{i=CryptoAgent.GetLastErrorDesc();alert(i)}}else{var i=CryptoAgent.GetLastErrorDesc();alert(i)}}else{var i=CryptoAgent.GetLastErrorDesc();alert(i)}}window.onload=function(){try{0<=navigator.appName.indexOf("Internet")||0<=navigator.appVersion.indexOf("Trident")?"x86"==window.navigator.cpuClass?document.getElementById("FakeCryptoAgent").innerHTML='<object id="CryptoAgent"  classid="clsid:8B94580C-E88F-4E0B-88A4-37077DCE1E4B" ></object>':document.getElementById("FakeCryptoAgent").innerHTML='<object id="CryptoAgent"  classid="clsid:9D95C4CD-D34D-45F2-BF98-2C50B7144E24" ></object>':document.getElementById("FakeCryptoAgent").innerHTML='<embed id="CryptoAgent" type="application/npCryptoKit.CertEnrollment.jtwd.x86" style="height: 0px; width: 0px">',CryptoAgent=document.getElementById("CryptoAgent"),0<=navigator.appName.indexOf("Internet")||0<=navigator.appVersion.indexOf("Trident")?"x86"==window.navigator.cpuClass?document.getElementById("eDiv").innerHTML='<object id="CryptoClient"  classid="clsid:51BAEA72-B6A9-487B-8D68-B32CE7251D9C" ></object>':document.getElementById("eDiv").innerHTML='<object id="CryptoClient"  classid="clsid:F989CBEB-F347-4BB9-AF28-44E9E81412D1" ></object>':document.getElementById("eDiv").innerHTML='<embed id="CryptoClient" type="application/npCryptoKit.jtwd.x86" style="height: 0px; width: 0px">',CryptoClient=document.getElementById("CryptoClient")}catch(e){}};