define(function(require,exports,module){var m=require("./database-importShow"),e=location.hash.split("?")[0].replace("#",".page-"),t={load:function(){m._load()}};$(function(){$("body").on("click","#J_expend_list,[name=closeList],.slide-mask",function(){"0"===$(".export-list").css("opacity")?($(".export-list").css("transform","translateX(0px)"),$(".export-list").css("opacity","1"),$(".slide-mask").show(),m.unScroll(),m.getExportList()):(m.reScroll(),$(".export-list").css("transform","translateX(800px)"),$(".export-list").css("opacity","0"),$(".slide-mask").hide())}),$("body").on("click","#J_export_list_search",function(){m.getList()}),$("body").on("keydown","#J_export_list_form [name=objectName]",function(e){"13"==e.keyCode&&(e.preventDefault(),m.getList())}),$("body").on("click",e+" #J_export_search",function(){App.checkDate($("#J_export_form"),"发生时间")&&m.getExportList()}),$("body").on("click","[name=download]",function(){var e=$(this).attr("filePath");App.blockUI({boxed:!0,message:"Processing..."}),m.downloadFile({fileClass:"CONFIG",filePath:e}).then(function(e){return m.downloadFile2({fileClass:"CONFIG",downloadToken:e.bcjson.items[0].downloadToken,_s_t_i_0000:$.kingdom.getValue("x-trace-user-id")})}).catch(function(e){console.error(e)})}),$("body").on("click","[name=reExport]",function(){var e=$(this).attr("logId"),t=$(this).attr("objectName");$("#J_reExport_edit_fileName [name=fileName]").val(t.substring(5,t.length-4)+"-副本"),$("#J_edit_fileName_reExport_modal").modal("show"),m.reExportParams={logId:e}}),$("body").on("click",e+" .reExport_edit_fileName_submit",function(){$("#J_reExport_edit_fileName").validate().form()&&($(".success-info-wrap .fileName").html($("#J_reExport_edit_fileName [name=fileName]").val()),$("#J_edit_fileName_reExport_modal").modal("hide"),m.reExport($.extend(m.reExportParams,{objectName:$("#J_reExport_edit_fileName [name=fileName]").val()})))}),$("body").on("mouseover","#import_question_title",function(){$(this).addClass("open")}),$("body").on("mouseout","#import_question_title",function(){$(this).removeClass("open")}),$("body").on("click","#J_export_rely",function(){0!==$("#J_table_tree tbody input:checked").length?($("#J_edit_fileName [name=fileName]").val("未命名"+m.timestampToTime()),$("#J_edit_fileName [name=fileName]").attr("listExport",!1),$("#J_edit_fileName [name=fileName]").attr("dataType","1"),$("#J_edit_fileName_modal").modal("show")):toastr.info("Please Select")}),$("body").on("click",e+" .edit_fileName_submit",function(){if($("#J_edit_fileName").validate().form()){$(".success-info-wrap .fileName").html($("#J_edit_fileName [name=fileName]").val());var e=$("#J_edit_fileName [name=fileName]").attr("dataType");if("true"==$("#J_edit_fileName [name=fileName]").attr("listExport"))return void m.export($.extend(m.exportListParams,{dataType:e},{objectName:$("#J_edit_fileName [name=fileName]").val()}));var t=m.filterCondition(),o=$("#collapseExample002 [name=objectName]").val(),a=$.extend({objectName:o},{dataType:e},t);m.export($.extend(a,{objectName:$("#J_edit_fileName [name=fileName]").val()}))}}),$("body").on("click","#J_export",function(){0!==$("#J_table_tree tbody input:checked").length?($("#J_edit_fileName [name=fileName]").val("未命名"+m.timestampToTime()),$("#J_edit_fileName [name=fileName]").attr("listExport",!1),$("#J_edit_fileName [name=fileName]").attr("dataType","0"),$("#J_edit_fileName_modal").modal("show")):toastr.info("Please Select")}),$("body").on("click",e+' #J_table_tree [name="export"]',function(){0<$("#J_table_tree [type=checkbox]:checked").length&&("checked"===$("#J_table_tree tr span:eq(0)").attr("class")||$("#J_table_tree tr input:eq(0)").click(),$("#J_table_tree tr input:eq(0)").click()),$(this).closest("tr").find("[type=checkbox]").click();var e=$(this).closest("tr").attr("level"),t=$("#J_table_tree [level=2] [type=checkbox]"),c=[],o=[],a=void 0;if("1"===e)t.length&&$.each(t,function(){var e=$(this).attr("objecttype");o.push(e)}),a=o.join(",");else if("2"===e)a=$(this).closest("tr").find("[type=checkbox]").attr("objecttype");else if("1"!==e&&"2"!==e){var i=$("#J_table_tree [type=checkbox]:checked");$.each(i,function(){var e="";if($(this).attr("obj")&&(e=JSON.parse($(this).attr("obj"))),e&&!e.folderName){var t=e,o=t.objectType,a=t.objectId,i=t.objectName,l=t.tableName,n=t.columnsId,r=t.objectClassType,m=t.folderId;c.push({objectType:o,objectId:a,objectName:i,tableName:l,columnsId:n,objectClassType:r,folderId:m})}})}var l=$("#collapseExample002 [name=objectName]").val();m.exportListParams={objectType:a,objectName:l,objectList:JSON.stringify(c)},$("#J_edit_fileName [name=fileName]").val("未命名"+m.timestampToTime()),$("#J_edit_fileName [name=fileName]").attr("listExport",!0),$("#J_edit_fileName [name=fileName]").attr("dataType","0"),$("#J_edit_fileName_modal").modal("show")}),$("body").on("click","#J_import",function(){if(""!=$("#J_import_file").val())if(""!=$("select[name=execDbConnectionId]").val()){var e=$("#J_import_modal .tab-content table"),r=[];$.each(e,function(e,t){var o=$(t).find("tbody input:checked");if(titleName=$("#J_import_modal [href=#tab_3_"+e+"]").html(),0===o.length)return toastr.info(" "+titleName+"请先选择数据"),!1;var a=m.filterConditionImport(e),i=$("#J_import_form [name=execDbConnectionId]").val(),l=m.deZipPaths,n=$.extend({execDbConnectionId:i,deZipPath:l[e]},a);r.push(n)}),e.length===r.length&&m.import({jsonConfig:r})}else toastr.error("请先选择数据连接!");else toastr.error("请先选择zip文件!")}),$("body").on("click","#J_tree_import",function(){App.clearForm("J_import_form"),$("#J_import_form [name=file]").val(""),$("#J_import_form span[role=textbox]").html(""),$("#J_import_modal .nav-tabs").html(""),$("#J_import_modal .tab-content").html(""),$("#execDbConnection").html(""),$("#J_import_modal").modal("show")}),$("body").on("change","#J_import_file",function(){m.getImportList()}),$("body").on("click",e+" #J_export_list [name=del]",function(e){e.stopPropagation();var t=$(this).attr("logId");bootbox.confirm("Please Confirm to delete",function(e){e&&m.del({logId:t})})}),$("body").on("click",e+' #J_export_list [name="checklog"]',function(){var e=$(this).attr("filename"),t=$(this).attr("content");m.downloadLog(e,t)})}),module.exports=t});