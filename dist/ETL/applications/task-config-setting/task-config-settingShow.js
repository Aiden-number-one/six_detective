var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};define(function(require,exports,module){require("plugins/jstree/dist/jstree"),require("plugins/jstree/dist/themes/default/style.css"),require("plugins/select2/js/select2.js"),require("plugins/select2/css/select2.css"),require("plugins/bootstrap-fileinput/bootstrap-fileinput.js"),require("plugins/bootstrap-fileinput/bootstrap-fileinput.css"),require("plugins/codemirror/codemirror.css"),require("plugins/codemirror/codemirror.js"),require("plugins/select2/css/select2-compatible.css"),require("plugins/codemirror/addon/hint/show-hint.css"),require("plugins/codemirror/addon/hint/show-hint.js"),require("plugins/codemirror/addon/hint/sql-hint.js"),require("plugins/codemirror/clike"),require("plugins/codemirror/sql"),require("plugins/drag/kd_drag.js"),require("plugins/sql-formatter-2.3.0/sql-formatter");var f=location.hash.split("?")[0].replace("#",".page-"),e=new(require("assets/js/global/treeCommon"))(f,"#J_foldname_tree","#J_foldname_query_btn","#J_foldname_query","2"),_={};function t(e,t,a,n){return new o(e,t,a,n)}function o(r,l,a,e){var i=this;this.option={mode:"text/x-plsql",lineNumbers:!0,lineWiseCopyCut:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:{}}},_[r]=CodeMirror.fromTextArea(document.getElementById(a),this.option),_[r].on("change",function(e,t){$("#"+a).val(_[r].getValue()).change()}),_[r].on("keyup",function(e,t){var a=$(l).val(),n=_[r].getCursor(),o=_[r].getLine(n.line).replace(/ /g,"\t");i.autoComplete(e,t,a,n,o)}),$(e).click(function(){_[r]&&setTimeout(function(){_[r].refresh()},10)}),$("#"+a).closest(".modal").on("shown.bs.modal",function(){setTimeout(function(){_[r].refresh()},10)}),$("#"+a).on("change",function(){$(this).closest("form").validate().element(this)})}_.dbTable=null,_.columnFileName=null,_.columnFileData=null,_.sourceTables=null,_.targetTable=null,_.procedureName=null,_.dataFildItems=null,_.parentFolderId=null,_.applyParam=null,_.successParam=null,_._load=function(){$.each($("input[type=text]:not([maxlength],[readonly])"),function(){$(this).attr("maxlength","32")}),$("input[name=exportPath]").removeAttr("maxlength"),$("input[name=exportName]").removeAttr("maxlength"),$("input[name=fileName]").removeAttr("maxlength"),$.each($("textarea:not([maxlength],[readonly])"),function(){$(this).attr("maxlength","256")}),$("[name=submitNum]").val("4096"),_.initForm(),App.initUniform(),e.getTask(),$.kingdom.getDict("TASK_TYPE","#J_task_type"),$.kingdom.getDict("TASK_TYPE","#J_task_option_1","","task-config-setting/template/task-option.handlebars"),$.kingdom.getDict("ROLLBACK_FLAG","[name=rollbackFlag]"),$.kingdom.getDict("BEFORE_RULE","[name=beforeRule]"),new Promise(function(e,t){$.kingdom.getDict("FILETYPE","select[name=fileType]",e)}).then(function(e){}),$.kingdom.getDict("OPER_TYPE","[fakename=operation]"),new Promise(function(e,t){$.kingdom.getDict("EXTEND_NAME","[name=extendName]",e)}).then(function(e){$("#J_form_TF [name=extendName]").find("option:contains('txt')").siblings().css("display","none")}),$.kingdom.getDict("CON_SEPARATOR","[name=taskSeparator]"),$.kingdom.getDict("FILE_CHARSET","[name=codeType]"),$.kingdom.getDict("SAFE_CONNECT_TYPE","[name=safeConnectType]"),$.kingdom.getDict("COMPRESS_TYPE","[name=compressType]"),$.kingdom.getDict("OPER_TYPE","[fakename=operator]"),t("cm_TE","#J_select2_single_tab_1_1","J_cm_TE",f+' a[href="#tab_1_2"]'),t("cm_TE_2","#J_select2_single_tab_1_2","J_cm_TE_2",f+' a[href="#tab_1_3"]'),t("cm_TE_3","#J_select2_single_tab_1_3","J_cm_TE_3",f+' a[href="#tab_1_3"]'),t("cm_TT","#J_modal_TT [name=connectionId]","J_cm_TT",f+' a[href="#tab_2_2"]'),t("cm_TV","#J_modal_TV [name=dbConnection]","J_cm_TV",f+' a[href="#tab_3_2"]'),t("cm_TP","#J_data_source_select2","J_cm_TP",f+' a[href="#tab_4_2"]'),t("cm_TF","#J_select2_single_tab_6_2","J_cm_TF",f+' a[href="#tab_6_2"]'),t("cm_TI","#J_select2_single_tab_1_9","J_cm_TI",f+' a[href="#tab_9_2"]')},_.getTaskList=function(e){var t={folderId:$("#J_foldname_tree li[aria-selected=true]").attr("folderId")};t=_extends(t,e),$.kingdom.getList({apiName:"bayconnect.superlop.get_task_info",apiVision:"v4.0",params:t,tableId:"J_task_table",pageId:"J_task_page",template:"task-config-setting/template/task-list.handlebars",formName:"J_task_form",cb:_.getTaskList})},_.setOptions=function(e){var a="";$.each($("#J_store_params tr:not([data-clone-sample]) [fakename=name]"),function(){var e=$(this).val(),t=$(this).parent().siblings().find("[fakename=direction]").val();e&&t.includes("OUT")&&(a+='<option value="'+e+'">'+e+"</option>")}),$("[name=returnVariable], [fakename=variable]").html(a),e&&$("[name=returnVariable], [fakename=variable]").val(e)},_.getTaskApiInfo=function(c){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_task_api_information","v4.0",c,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items[0],a=$("#J_task_option_1 a[data-id="+c.taskType+"]").data("target"),n=$(a).find("form[type=main]").attr("name");if(App.setFormData(n,t),"#J_modal_AS"===a){var o=t.apiParamsInputCommon&&JSON.parse(t.apiParamsInputCommon)||[],r="";o.forEach(function(e,t){r=0===t?'<div name="apiParamsInputCommon" style="position: relative;height: 60px;">\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Name：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.name+'" name="name" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Value：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" name="value" value="'+e.value+'" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Location：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <select class="form-control" name="position">\n                                    '+("Header"===e.position?' <option value="Header" selected>Header</option>':' <option value="Header">Header</option>')+"\n                                    "+("Body"===e.position?' <option value="Body" selected>Body</option>':' <option value="Body">Body</option>')+'\n                                    </select>\n                                </div>\n                            </div>\n                            <a style="position: relative;top: 8px;right: 0;" title="" id=\'add\'><i class="fa fa-plus"></i></a>\n                        </div>':r+'<div name="apiParamsInputCommon" style="position: relative;height: 60px;">\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Name：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.name+'" name="name" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Value：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.value+'" name="value" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Location：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <select class="form-control" name="position">\n                                    '+("Header"===e.position?' <option value="Header" selected>Header</option>':' <option value="Header">Header</option>')+"\n                                    "+("Body"===e.position?' <option value="Body" selected>Body</option>':' <option value="Body">Body</option>')+'\n                                    </select>\n                                </div>\n                            </div>\n                            <a style="position: relative;top: 8px;right: 0;" id=\'del\' title=""><i class="fa fa-trash-o"></i></a>\n                        </div>'}),$("#tab_14_2 [name=apiParamsInputCommon]").after(r),$("#tab_14_2 [name=apiParamsInputCommon]")[0].remove();var l=t.apiParamsInput&&JSON.parse(t.apiParamsInput)||[],i="";l.forEach(function(e,t){i=0===t?'<div name="apiParamsInput" style="position: relative;height: 60px;">\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Name：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.name+'" name="name" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Value：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" name="value" value="'+e.value+'" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Location：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <select class="form-control" name="position">\n                                    '+("Header"===e.position?' <option value="Header" selected>Header</option>':' <option value="Header">Header</option>')+"\n                                    "+("Body"===e.position?' <option value="Body" selected>Body</option>':' <option value="Body">Body</option>')+'\n                                    </select>\n                                </div>\n                            </div>\n                            <a style="position: relative;top: 8px;right: 0;" title="" id=\'add\'><i class="fa fa-plus"></i></a>\n                        </div>':i+'<div name="apiParamsInput" style="position: relative;height: 60px;">\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Name：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.name+'" name="name" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Value：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <input type="text" class="form-control" maxlength="64" value="'+e.value+'" name="value" placeholder="64 characters maximum">\n                                </div>\n                            </div>\n                            <div class="form-group col-md-4">\n                                <label class="control-label col-md-4">\n                                    <span>Location：</span>\n                                </label>\n                                <div class="form-group col-md-8">\n                                    <select class="form-control" name="position">\n                                    '+("Header"===e.position?' <option value="Header" selected>Header</option>':' <option value="Header">Header</option>')+"\n                                    "+("Body"===e.position?' <option value="Body" selected>Body</option>':' <option value="Body">Body</option>')+'\n                                    </select>\n                                </div>\n                            </div>\n                            <a style="position: relative;top: 8px;right: 0;" id=\'del\' title=""><i class="fa fa-trash-o"></i></a>\n                        </div>'}),$("#tab_14_3 [name=apiParamsInput]").after(i),$("#tab_14_3 [name=apiParamsInput]")[0].remove();var s=t.apiParamsOutput&&JSON.parse(t.apiParamsOutput)||[];s[0]&&($("#tab_14_3 [name=apiParamsOutput] [name=name]").val(s[0].name),$("#tab_14_3 [name=apiParamsOutput] [name=successful]").val(s[0].successful),$("#tab_14_3 [name=apiParamsOutput] [name=failed]").val(s[0].failed)),$("#tab_14_3 [name=requestType]").val(t.requestType),$("#tab_14_3 [name=responseDataFormat]").val(t.responseDataFormat)}App.updateUniform(),$(a+" [type=jstree]").jstree(!0).open_all(),$(a+" [type=jstree] [folderid="+t.folderId+"]>.jstree-anchor").click(),$(a+" .J_save").data("tasktype",c.taskType).data("type","edit"),$(a+" [name=requestSecretWord]").removeAttr("changed"),$(a).modal("show")}})},_.getTaskInfo=function(p){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_task_detail_info","v4.0",p,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items[0],a=$("#J_task_option_1 a[data-id="+p.taskType+"]").data("target"),n=$(a).find("form[type=main]").attr("name");if(_.sftpSecretword=t.sftpSecretword,App.setFormData(n,t),"#J_modal_TFP"===a&&(_.dbTable=t.dbTable,_.columnFileName=t.columnFileName,_.columnFileData=t.columnFileData,$("#J_select2_single_tab_13_1").change()),"#J_modal_TE"===a){_.sourceTables=t.sourceTables,_.targetTable=t.targetTable,$("#J_select2_single_tab_1_1").change(),$("#J_select2_single_tab_1_3").change(),$("[name=submitNum]").val(t.submitNum),t.transScript&&_.cm_TE.setValue(sqlFormatter.format(t.transScript,{language:"n1ql",indent:"    "})),t.createTableScript&&_.cm_TE_2.setValue(sqlFormatter.format(t.createTableScript)),t.deleteSql&&_.cm_TE_3.setValue(sqlFormatter.format(t.deleteSql)),$("[name=beforeRule]").change();var o=JSON.parse(t.mappingInfo).mappingColumn;0<o.length&&require.async("./template/data-field-list.handlebars",function(e){$("#J_data_field_tbody").html(e(o)),_.haddleDataField.init(o),App.initCheckableTable($("#J_data_field_table"))})}if("#J_modal_TT"===a&&($("#J_select2_single_tab_2_2").change(),t.command&&_.cm_TT.setValue(t.command)),"#J_modal_TV"===a&&($("#J_select2_single_tab_3_2").change(),t.variableScript&&_.cm_TV.setValue(sqlFormatter.format(t.variableScript))),"#J_modal_TP"===a){_.procedureName=t.procedureName,$("#J_data_source_select2").change();var r=JSON.parse(t.taskParameters);_.haddleParams.setData(r.parameters),_.setOptions(t.returnVariable),$("[fakename=rvariable]").val(r.returnmessage.rvariable),$.each($("#J_success_condition [fakename]"),function(){var e=$(this).attr("fakename");$(this).val(r.successcondition[e])})}if("#J_modal_TI"===a){t.fileUrl&&($("[data-provides=fileinput]").removeClass("fileinput-new").addClass("fileinput-exists"),$(".fileinput-filename").html(t.fileName+" "),$("[data-importtype] [name=fileUrl]").val(t.fileUrl),$("[data-importtype] [name=fileType]").val(t.fileType),$("[data-importtype] [name=fileName]").val(t.fileName),$(f+" select[name=fileType]").change()),_.targetTable=t.targetTable,$("#J_select2_single_tab_1_9").val(t.targetConnectionId).change(),$("[name=submitNum]").val(t.submitNum).change(),$("[name=beforeRule]").change(),$("[name=fileClass]").val("TASK"),t.startImportLine&&"1"!==t.startImportLine?($("#J_import_txt_start_line input")[1].click(),$("[name=startImportLine]").val(t.startImportLine)):$("#J_import_txt_start_line input")[0].click(),t.deleteSql&&_.cm_TI.setValue(sqlFormatter.format(t.deleteSql));var l=JSON.parse(t.mappingInfo).mappingColumn;if(0<l.length){var i=!0,s=!1,c=void 0;try{for(var d,m=l[Symbol.iterator]();!(i=(d=m.next()).done);i=!0){var u=d.value;u.columnName=u.targetColumn}}catch(e){s=!0,c=e}finally{try{!i&&m.return&&m.return()}finally{if(s)throw c}}require.async("./template/data-field-list-2.handlebars",function(e){$("#J_data_field_tbody_2").html(e(l)),_.haddleDataField_2.init(l),App.initCheckableTable($("#J_data_field_table_2"))})}}"#J_modal_TF"===a&&($("#J_select2_single_tab_6_2").change(),t.command&&_.cm_TF.setValue(sqlFormatter.format(t.command)),$("[name=headFlag]").change()),"#J_modal_DQ"===a&&(_.applyParam=t.applyParam,$("#J_select2_single_tab_11_1").val(t.ruleFolderId).change()),"#J_modal_DR"===a&&($("#J_modify_filename").html(""),"all"!==t.sourceUrl?($("#tab_12_3 .zdy").click(),$("[name=a1006FilesPath]").val(t.sourceUrl)):$("#tab_12_3 .all").click(),"0"===t.isRename&&($("[name=targetFileName]").hide().attr("type","hidden"),$("[name=sourceFileName]").hide().attr("type","hidden"),$("#modify_file_content").hide()),$("#modify_file_content [name=targetFileName]").val()&&$("#modify_file_content [name=targetFileName]").blur()),"#J_modal_TZ"===a&&(t.a1005FilesPath?$("#J_TZ_file_range input")[1].click():$("#J_TZ_file_range input")[0].click()),App.updateUniform(),$(a+" [type=jstree]").jstree(!0).open_all(),$(a+" [type=jstree] [folderid="+t.folderId+"]>.jstree-anchor").click(),$(a+" .J_save").data("tasktype",p.taskType).data("type","edit"),$(a+" [name=userPassword]").removeAttr("changed"),$(a).modal("show")}})},_.moveTaskInfo=function(t){App.blockUI({boxed:!0,message:"Processing..."}),$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_task_folder_trans","v4.0",t,function(e){"1"==e.bcjson.flag?(toastr.success(e.bcjson.msg),$("#J_foldname_tree li[folderId="+t.targetFolderId+"]>a").click(),_.getTaskList(),$("#J_task_move_modal").modal("hide")):toastr.error(e.bcjson.msg),App.unblockUI()})},_.delTaskInfo=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_task_info_del","v4.0",e,function(e){"1"==e.bcjson.flag?(App.unblockUI(),toastr.success(e.bcjson.msg),_.getTaskList()):toastr.error(e.bcjson.msg)})},_.copyTaskInfo=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_task_info_copy","v4.0",e,function(e){"1"==e.bcjson.flag?(App.unblockUI(),toastr.success(e.bcjson.msg),_.getTaskList()):toastr.error(e.bcjson.msg)})},_.checkRelateJob=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_relate_job_info","v4.0",e,function(t){"1"==t.bcjson.flag?0<t.bcjson.lengths?require.async("./template/job-list.handlebars",function(e){$("#J_relate_job_list").html(e(t.bcjson.items))}):$("#J_relate_job_list").html('<tr><td colspan="2" class="text-center">No Data</td></tr>'):toastr.error(t.bcjson.msg)})},_.setTaskInfo=function(e,t,a){App.blockUI({boxed:!0,message:"Processing..."});var n="add"===t?"bayconnect.superlop.set_task_info":"bayconnect.superlop.set_task_info_modify";$.kingdom.doKoauthAdminAPI(n,"v4.0",e,function(e){App.unblockUI(),"1"==e.bcjson.flag?(toastr.success(e.bcjson.msg),"function"==typeof a&&a(e)):toastr.error(e.bcjson.msg)})},_.setWebTaskInfo=function(e,t){App.blockUI({boxed:!0,message:"Processing..."});$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_task_api_information","v4.0",e,function(e){App.unblockUI(),"1"==e.bcjson.flag?(toastr.success(e.bcjson.msg),"function"==typeof t&&t(e)):toastr.error(e.bcjson.msg)})},_.setEditTaskInfo=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_task_info_modify","v4.0",e,function(e){})},_.clearData=function(){$.each($(".modal form[type=main]"),function(){var e=$(this).attr("name");App.clearForm(e)}),_.haddleParams.delAllRow(),$(".select2-hidden-accessible").empty().clearInputs(),$("[name=returnVariable]").html(""),$("[name=submitNum]").val("4096"),$(".modal input").prop("checked",!1).parent().removeClass("checked"),$("#J_sql_preview_table, #J_data_field_tbody, #J_sql_preview_thead, #J_data_field_tbody_2, #J_query_datafield_result_table").html(""),$("[name=importType]")[0].click(),$("#J_import_txt_start_line input")[0].click(),$("#tab_12_3 .zdy").click(),$("#J_is_modify_file input[name=isRename]:eq(0)").val("0"),$("#J_is_modify_file input[name=isRename]:eq(1)").val("1"),$("#J_modify_filename").html(""),$("#J_is_modify_file input")[1].click(),$("#J_TZ_file_range input")[0].click(),$("[data-provides=fileinput]").addClass("fileinput-new").removeClass("fileinput-exists"),$(".fileinput-filename").html(""),$("[name=fileClass]").val("TASK"),_.cm_TE.setValue(""),_.cm_TE_2.setValue(""),_.cm_TE_3.setValue(""),_.cm_TT.setValue(""),_.cm_TV.setValue(""),_.cm_TP.setValue(""),_.cm_TI.setValue(""),_.cm_TF.setValue(""),$("[name=beforeRule]").change(),App.updateUniform()},_.getDataSourceList=function(c){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_data_source_config","v4.0",{},function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a=[{id:"",text:""}];if(t&&0<t.length){var n=!0,o=!1,r=void 0;try{for(var l,i=t[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;a.push({id:s.connectionId,text:s.connectionName})}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}$("#J_select2_single_tab_1_1").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_1_3").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_2_2").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_3_2").select2({data:a,placeholder:"- Please select a type -"}),$("#J_data_source_select2").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_1_9").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_13_1").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_6_2").select2({data:a,placeholder:"- Please select a type -"}),$("#J_select2_single_tab_13_1").select2({data:a,placeholder:"- Please select a type -"}),"function"==typeof c&&c()}})},_.getTableList=function(e,d,m,u){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_metadata_table_info","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a=[{id:"",text:""}],n=[];if(t){var o=!0,r=!1,l=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done);o=!0){var c=i.value;a.push({id:c.tableId,text:c.schemName+"."+c.tableName+"("+(c.tableDesc||c.mdType)+")"}),n.push({id:c.tableId,text:c.schemName+"."+c.tableName})}}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}}$(d).empty().clearInputs(),$(d).select2({data:a,placeholder:"- Please select a type -",tags:m}),$(d).data("origin",n),"function"==typeof u&&u()}})},_.getRuleFolder=function(c){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_folder_menu","v4.0",{fileType:"3"},function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a=[{id:"",text:""}];if(t&&0<t.length){var n=!0,o=!1,r=void 0;try{for(var l,i=t[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;a.push({id:s.folderId,text:s.foldName})}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}$("#J_select2_single_tab_11_1").select2({data:a,placeholder:"- Please select a type -"}),"function"==typeof c&&c()}})},_.getRuleList=function(e,c){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_data_rule_info","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a=[];if(t&&0<t.length){var n=!0,o=!1,r=void 0;try{for(var l,i=t[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;a.push({id:s.ruleId,text:s.ruleName})}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}$("#J_select2_multi_tab_11_1").empty().clearInputs(),$("#J_select2_multi_tab_11_1").select2({data:a,placeholder:"- Please select a type -",multiple:!0}).data("obj",t),"function"==typeof c&&c()}})},_.getSQL=function(e,a){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_qry_statement","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items[0].qryStatement;_.cm_TE.setValue(t),"function"==typeof a&&a(t)}})},_.getPreviewSQL=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_qry_statement_result","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(!t||0===t.length)return void toastr.info("No Data");for(var a='<thead><tr><th style="width: 40px"> No </th>',n="<tbody>",o=t.length,r=0;r<o;r++){var l=t[r],i="<tr><td> "+(r+1)+" </td>";for(var s in l)0===r&&(a+="<th> "+s+" </th>"),i+="<td> "+l[s]+" </td>";n+=i+="</tr>"}var c='<div class="table-scrollable mt10" style="max-height:500px;">\n                    <table class="table table-striped table-bordered table-hover order-column">\n                        '+(a+="</tr></thead>")+"\n                        "+(n+="</tbody>")+"\n                    </table>\n                </div>";$("#J_sql_preview_table, #J_query_datafield_result_table").html(c)}})},_.getBuildTableSQL=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_create_statement","v4.0",e,function(e){"1"==e.bcjson.flag&&_.cm_TE_2.setValue(e.bcjson.items[0].createStatement.replace(/\([\u4e00-\u9fa5]+\)/g,""))})},_.getDataField=function(p,f){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_column_mapping_info","v4.0",p,function(e){if("1"==e.bcjson.flag){var a=e.bcjson.items;if(0===a.length)return void toastr.info("Mapping field is missing.");var t=$("#J_select2_multi_tab_1_3").data("origin"),n=!0,o=!0,r=!1,l=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done);o=!0){i.value.id===p.targetTableId&&(n=!1)}}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}if(n){var c=$("#J_cm_TE_2").val().replace(/[\n]/g," ").replace(/[\t]/g," ");if(!c)return void toastr.info("Object SQL is missing.");for(var d=function(e){return e.match(/(\(\s+|,\s+)\w+\s/g).map(function(e,t){return e.replace(/(\(|,|\s)/g,"")})}(c),m=0,u=a.length;m<u;m++)d[m]&&(a[m].targetColumn=d[m])}require.async("./template/data-field-list.handlebars",function(e){_.dataFildItems=a;var t=_.haddleDataField.getRow();0===t||"2"===p.searchType||"3"===p.searchType||"refresh"===f?($("#J_data_field_tbody").html(e(a)),_.haddleDataField.init(a),App.initCheckableTable($("#J_data_field_table"))):($("#J_haddle_new_data .colored-red").html(t),$("#J_haddle_new_data .colored-blue").html(a.length),$("#J_haddle_new_data").css({height:"auto",opacity:"1",padding:"8px 10px",transition:".5s ease-in-out"}))})}})},_.haddleDataField={init:function(e){var t='<select class="form-control input-sm"><option value="">- Please select a type -</option>',a='<select class="form-control input-sm"><option value="">- Please select a type -</option>',n=!0,o=!1,r=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;s.targetColumn&&(t+='<option value="'+s.targetColumn+'">'+s.targetColumn+"</option>"),a+='<option value="'+s.sourceColumn+'">'+s.sourceColumn+"</option>"}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}t+="</select>",a+="</select>",$.each($("#J_data_field_tbody [data-type=target]:not([inited])"),function(){var e=$.trim($(this).html());e&&$(this).html(t).attr("inited","inited").children().val(e)}),$.each($("#J_data_field_tbody [data-type=source]:not([inited])"),function(){var e=$.trim($(this).html());e?$(this).html(a).attr("inited","inited").children().val(e):$(this).html('<input class="form-control" type="text">')}),$("#J_data_field_tbody [data-type=target] select:first").change()},refresh:function(){$.each($("#J_data_field_tbody tr td[data-type]"),function(){var e=$(this).data("origin");$(this).children().val(e)})},getRow:function(){return $("#J_data_field_tbody tr").length},appendNew:function(){var t=[],a=[];$.each($("#J_data_field_tbody tr [data-type=target]"),function(){var e=$(this).children().val();t.push(e)});var e=_.dataFildItems,n=!0,o=!1,r=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;t.includes(s.targetColumn)||a.push(s)}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}require.async("./template/data-field-list.handlebars",function(e){$("#J_data_field_tbody").append(e(a)),_.haddleDataField.init(a),_.haddleDataField.reorder(),App.initCheckableTable($("#J_data_field_table"))}),_.haddleDataField.reorder()},appendAll:function(){require.async("./template/data-field-list.handlebars",function(e){$("#J_data_field_tbody").append(e(_.dataFildItems)),_.haddleDataField.init(_.dataFildItems),_.haddleDataField.reorder(),App.initCheckableTable($("#J_data_field_table"))})},clearAppendAll:function(){require.async("./template/data-field-list.handlebars",function(e){$("#J_data_field_tbody").html(e(_.dataFildItems)),_.haddleDataField.init(_.dataFildItems),App.initCheckableTable($("#J_data_field_table"))})},delCheckedRow:function(){0===$("#J_data_field_tbody input[type=checkbox]:checked").length&&toastr.info("Please select the Row"),$.each($("#J_data_field_tbody input[type=checkbox]:checked"),function(e){$(this).closest("tr").remove()}),_.haddleDataField.reorder()},reorder:function(){$.each($("#J_data_field_tbody tr"),function(e){$(this).find("td:first").text(e+1)})},getData:function(){var o=new Array;return $.each($("#J_data_field_tbody tr"),function(e){var t=$(this).find("[data-type=source] select").val(),a=$(this).find("[data-type=target] select").data("v"),n={no:(e+1).toString(),sourceColumn:t,targetColumn:a};t&&a&&o.push(n)}),JSON.stringify({mappingColumn:o})}},_.getStoredProcedure=function(e,c){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_qry_statement_result","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a=[{id:"",text:""}];if(t&&0<t.length){var n=!0,o=!1,r=void 0;try{for(var l,i=t[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value.OBJECTNAME;a.push({id:s,text:s})}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}$("#J_stored_procedure_select2").empty().clearInputs(),$("#J_stored_procedure_select2").select2({data:a,placeholder:"- Please select a type -"}),$("#J_stored_procedure_select2").data("origin",a),"function"==typeof c&&c()}})},_.getStoredProcedurePreview=function(e,t){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_proc_statement","v4.0",e,function(e){"1"==e.bcjson.flag?"function"==typeof t&&t(e):toastr.error(e.bcjson.msg)})},_.testStore=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_proc_test_info","v4.0",e,function(e){"1"==e.bcjson.flag?toastr.success(e.bcjson.msg):toastr.error(e.bcjson.msg),App.unblockUI()})},_.getDataField_2=function(e){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_metadata_column_info","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(0===t.length)return void toastr.info("Mapping field is missing.");require.async("./template/data-field-list-2.handlebars",function(e){$("#J_data_field_tbody_2").html(e(t)),_.haddleDataField_2.init(t),App.initCheckableTable($("#J_data_field_table_2"))})}})},_.getDataField_3=function(e,n,o){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_metadata_column_info","v4.0",e,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(0===t.length)return;var a=t.map(function(e){return{id:e.columnName,text:e.columnName}});if(n)template="common-template/dict-option.handlebars",n.split(",").forEach(function(t){require.async($.kingdom.kconfig().root+template,function(e){$(t).html(e(a))})});o&&o()}})},_.haddleDataField_2={init:function(e){var t='<select class="form-control input-sm"><option value="">- Please select a type -</option>',a=!0,n=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var i=r.value;t+='<option value="'+i.columnName+'">'+i.columnName+"</option>"}}catch(e){n=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw o}}t+="</select>",$.each($("#J_data_field_tbody_2 [data-type=target]:not([inited])"),function(){var e=$.trim($(this).data("origin"));$(this).html(t).attr("inited","inited").children().val(e)}),$("#J_data_field_tbody_2 [data-type=target] select:first").change()},refresh:function(){$.each($("#J_data_field_tbody_2 tr td[data-type]"),function(){var e=$(this).data("origin");$(this).children().val(e)})},getRow:function(){return $("#J_data_field_tbody_2 tr").length},delCheckedRow:function(){0===$("#J_data_field_tbody_2 input[type=checkbox]:checked").length&&toastr.info("Please select the Row"),$.each($("#J_data_field_tbody_2 input[type=checkbox]:checked"),function(e){$(this).closest("tr").remove()}),_.haddleDataField_2.reorder()},reorder:function(){$.each($("#J_data_field_tbody_2 tr"),function(e){$(this).find("td:first").text(e+1),$(this).find("td[data-type=import]").html(" The "+(e+1)+" Column ")})},getData:function(){var n=new Array;return $.each($("#J_data_field_tbody_2 tr"),function(e){var t=$(this).find("[data-type=target] select").data("v"),a={no:(e+1).toString(),sourceColumn:(e+1).toString(),targetColumn:t};n.push(a)}),JSON.stringify({mappingColumn:n})}},_.getDictShield=function(){},_.initForm=function(){$("#J_form_TE").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},sourceConnection:{required:!0},sourceTables:{required:!0},targetConnection:{required:!0},targetTable:{required:!0},submitNum:{required:!0,numCheck:!0},deleteSql:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TT").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},connectionId:{required:!0},transRule:{required:!0},command:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TV").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},variableName:{required:!0,specialCharacter:!0},connectionId:{required:!0},variableScript:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TP").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},dbConnection:{required:!0},procedureName:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TF").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},dbConnection:{required:!0},command:{required:!0},extendName:{required:!0},exportPath:{required:!0,maxlength:128},exportName:{required:!0,maxlength:128},catalogFlag:{required:!0},addFlag:{required:!0},headFlag:{required:!0},taskSeparator:{required:!0},headerContent:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TM").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},recieveAddress:{required:!0},codeType:{required:!0},mailTopic:{required:!0},mailNote:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TI").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},fileType:{required:!0},fileUrl:{required:!0,maxlength:64},fileName:{required:!0,maxlength:64},taskSeparator:{required:!0},submitNum:{required:!0,numCheck:!0},beforeRule:{required:!0},deleteFileFlag:{required:!0},deleteSql:{required:!0},targetConnectionId:{required:!0},targetTable:{required:!0},startImportLine:{required:!0,startImportLineCheck:!0},sftpIp:{required:!0},sftpPort:{required:!0},sftpUsername:{required:!0},sftpSecretword:{required:!0},sftpPath:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TZ").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},compressType:{required:!0},filePath:{required:!0},fileName:{required:!0,maxlength:64},a1005FilesPath:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_DQ").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},ruleFolderId:{required:!0},ruleids:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_TFP").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},connectionId:{required:!0},dbTable:{required:!0},columnFileName:{required:!0},columnFileData:{required:!0},isAuth:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_AS").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},baseUrl:{required:!0},subUrl:{required:!0},requestUserName:{required:!0},requestSecretWord:{required:!0},requestType:{required:!0},responseDataFormat:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$("#J_form_DR").validate({debug:!0,errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{taskName:{required:!0},folderName:{required:!0},uploadUrl:{required:!0},sourceUrl:{required:!0},isRename:{required:!0},targetFileName:{required:!0},sourceFileName:{required:!0},a1006FilesPath:{required:!0}},invalidHandler:function(){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,t){e.insertAfter(t)},submitHandler:function(){}}),$.validator.addMethod("startImportLineCheck",function(e){return/^([1-9]\d+|[2-9])$/.test(e)},"Please input an integer > 1")},o.prototype.getTable=function(c,d){$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_db_metadata_tables","v4.0",c,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items,a={};if(0===t.length)return;var n=!0,o=!1,r=void 0;try{for(var l,i=t[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var s=l.value;a[c.schema+"."+s.TABLE_NAME]=[]}}catch(e){o=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}d(a)}})},o.prototype.autoComplete=function(t,e,a,n,o){var r=this;if(!t.state.completionActive&&(65<=e.keyCode&&e.keyCode<=90||52==e.keyCode||219==e.keyCode)&&CodeMirror.commands.autocomplete(t,null,{completeSingle:!1}),190===e.keyCode){var l;if(o.split("\t").forEach(function(e,t){o.lastIndexOf(e)+e.length===n.ch&&(l=e.replace(/[.\s\t]/g,""))}),!l)return;this.getTable({schema:l,connection_id:a},function(e){r.option.hintOptions.tables=e,CodeMirror.commands.autocomplete(t,null,{completeSingle:!1})})}},module.exports=_});