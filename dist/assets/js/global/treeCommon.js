define(function(require,exports,module){module.exports=function(e,t,i,r,o){var c=this;this.PAGE=e,this.tree=t,this.queryBtn=i,this.queryInput=r,this.fileType=o;var a=this;this.getTask=function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],s=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],a=arguments[3],l=arguments[4],n=arguments[5],d=c;$.kingdom.doKoauthAdminAPI("bayconnect.superlop.get_folder_menu","v4.0",{fileType:c.fileType},function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items;if(r&&(t=$.kingdom.filterFoldName(e.bcjson.items,r)),0===t.length)return void $(""+c.tree).html('<div class="no-data">没有查询数据</div>');var i=(new $.kingdom.generateTreeData).init("",t,"foldName","folderId");o&&($(""+c.tree).jstree("destroy"),$(""+c.tree).html(i),$(""+c.tree).jstree({core:{themes:{responsive:!1},check_callback:!0},plugins:["types","themes","html_data","state"]}),$(""+c.tree).jstree(!0),$(""+c.tree).on("ready.jstree",function(e,t){a?$(d.tree+" li[folderid="+a+"]>.jstree-anchor").click():$(d.tree+" .jstree-anchor:first").click();var i=t.instance,r=i.get_node(e.target.firstChild.firstChild.lastChild);i.open_node(r),n&&i.open_all(),App.treeEllipsis(""+d.tree),l&&l()})),s&&($(c.PAGE+" [type=jstree]").jstree("destroy"),$(c.PAGE+" [type=jstree]").html(i),$(c.PAGE+" [type=jstree]").jstree({types:{default:{icon:!1}},core:{themes:{responsive:!1},check_callback:!0},plugins:["types","themes","html_data","contextmenu","state"]}))}})},this.addTask=function(i){var r=c,e=$.trim(i.text),o={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"ADD",folderName:e,parentFolderId:parentFolderId,isParentFolder:"#"===i.parents[1]?"1":"0"};if(!e)return toastr.info("File Name is missing"),void r.getTask("",!0,!1,o.parentFolderId);$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",o,function(e){if("1"==e.bcjson.flag){var t=e.bcjson.items[0].folderId;$(c.tree+" li[id="+i.id+"]").attr("folderId",t),r.getTask("",!0,!0,t),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)}else r.getTask("",!0,!1,o.parentFolderId),toastr.error(e.bcjson.msg)})},this.editTask=function(t){var i=c,e=$.trim(t.text),r={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"UPD",folderName:e,folderId:t.li_attr.folderid};if(!e)return toastr.info("File Name is missing"),void i.getTask("",!0,!1,r.folderId);$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",r,function(e){"1"==e.bcjson.flag?($(c.tree+" li[id="+t.id+"]").attr("folderId",r.folderId),i.getTask("",!0,!0,r.folderId),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)):(i.getTask("",!0,!1,r.folderId),toastr.error(e.bcjson.msg))})},this.delTask=function(t){var i=c,r={fileType:c.fileType,creator:localStorage.getItem("loginName"),operType:"DEL",folderId:t.folderId};$.kingdom.doKoauthAdminAPI("bayconnect.superlop.set_folder_menu_modify","v4.0",r,function(e){"1"==e.bcjson.flag?($(c.tree+" li[id="+t.parent+"]>a").click(),i.getTask("",!1,!0),App.treeEllipsis(""+c.tree),toastr.success(e.bcjson.msg)):(i.getTask("",!0,!1,r.folderId),toastr.error(e.bcjson.msg))})},$("body").on("click",this.PAGE+" "+this.queryBtn,function(){var e=$.trim($(a.PAGE+" "+a.queryInput).val());a.getTask(e,!0,!1,"","",!0)}),$("body").on("keydown",this.PAGE+" "+this.queryInput,function(e){if("13"==e.keyCode){e.preventDefault();var t=$.trim($(this).val());a.getTask(t,!0,!1,"","",!0)}}),$("body").on("mouseenter",this.tree+" .jstree-anchor",function(){var e=$(this).closest("li").attr("aria-level");1!==$(this).find(".jstree-operate").length&&("1"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#10416c;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#10416c;"></i></a></div>'):"2"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#10416c;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#10416c;"></i></a><a name="del" title="DELETE"><i class="glyphicon glyphicon-trash" style="color:#10416c;"></i></a></div>'):"3"===e?$(this).append('<div class="jstree-operate"><a name="add" title="ADD"><i class="glyphicon glyphicon-plus" style="color:#10416c;"></i></a><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#10416c;"></i></a><a name="del" title="DELETE"><i class="glyphicon glyphicon-trash" style="color:#10416c;"></i></a></div>'):$(this).append('<div class="jstree-operate"><a name="edit" title="EDIT"><i class="glyphicon glyphicon-pencil" style="color:#10416c;"></i></a><a name="del" title="DELTTE"><i class="glyphicon glyphicon-trash" style="color:#10416c;"></i></a></div></div>'))}),$("body").on("mouseleave",this.tree+" .jstree-anchor",function(){$(".jstree-operate").remove()}),$("body").on("click",this.PAGE+" .jstree-operate [name=add]",function(e){var t=$(this).closest(".jstree-anchor"),i=$.jstree.reference(t),r=i.get_node(t);parentFolderId=$(a.tree+" li[id="+r.id+"]").attr("folderid");var o=r.parents.length;if(3<o)toastr.info("不能创建子目录");else{r.types=["fa fa-folder icon-state-primary icon-lg","fa fa-folder icon-state-primary","fa fa-file icon-state-default","fa fa-file icon-state-primary","fa fa-file icon-state-primary"][o];var s=i.create_node(r,{},"first");i.edit(s,$.trim(s.val),"64",a.addTask)}}),$("body").on("click",this.PAGE+" .jstree-operate [name=edit]",function(e){var t=$(this).closest(".jstree-anchor"),i=$.jstree.reference(t),r=i.get_node(t);r.li_attr.folderid=$(a.tree+" li[id="+r.id+"]").attr("folderid"),i.edit(t,$.trim(r.text),"64",a.editTask)}),$("body").on("click",this.PAGE+" .jstree-operate [name=del]",function(e){var i=$(this).closest(".jstree-anchor"),r=$.jstree.reference(i),o=r.get_node(i);o.li_attr.folderid=$(a.tree+" li[id="+o.id+"]").attr("folderid"),bootbox.confirm("Please confirm to delete  <span style='color:red'>"+o.text+"</span>",function(e){if(e){r.delete_node(i);var t=o.li_attr.folderid;a.delTask({folderId:t,parent:o.parent})}})})}});